<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAD - Santana de Parnaíba | Pro Intelligence</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700;900&display=swap');
        body { font-family: 'Montserrat', sans-serif; background-color: #0f172a; color: #f8fafc; }
        .glass-panel { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); }
        .escala-viewer { height: calc(100vh - 160px); overflow-y: auto; border-radius: 24px; border: 2px solid #334155; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #475569; border-radius: 10px; }
        .card-troca { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .card-troca:hover { transform: translateX(10px); background: rgba(51, 65, 85, 0.5); }
    </style>
</head>
<body class="overflow-hidden">

    <header class="h-20 flex items-center px-8 border-b border-slate-800 bg-slate-900/50 backdrop-blur-md">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center gap-4">
                <div class="bg-amber-500 text-slate-900 p-2.5 rounded-xl shadow-lg shadow-amber-500/20">
                    <i class="fa-solid fa-scale-unbalanced-flip text-xl"></i>
                </div>
                <div>
                    <h1 class="text-lg font-black tracking-tighter uppercase leading-none">Comissão de Dativos</h1>
                    <span class="text-amber-500 text-[10px] font-bold tracking-[0.4em] uppercase">Santana de Parnaíba</span>
                </div>
            </div>
            <div class="flex items-center gap-6">
                <label for="upEscala" class="cursor-pointer bg-slate-800 hover:bg-slate-700 px-4 py-2 rounded-full text-[10px] font-black uppercase tracking-widest transition-all border border-slate-700">
                    <i class="fa-solid fa-file-export mr-2"></i> Atualizar Escala
                </label>
                <input type="file" id="upEscala" class="hidden" accept="image/*,application/pdf" onchange="uploadEscala(this)">
                <div id="relogio" class="text-xs font-mono text-slate-500"></div>
            </div>
        </div>
    </header>

    <main class="h-[calc(100vh-80px)] p-6">
        <div class="container mx-auto h-full grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            <div class="lg:col-span-5 flex flex-col gap-4">
                <div class="flex justify-between items-center px-2">
                    <h2 class="text-xs font-black text-slate-500 uppercase tracking-widest italic">Escala de Fevereiro 2026</h2>
                    <button onclick="zoomEscala()" class="text-slate-500 hover:text-white"><i class="fa-solid fa-magnifying-glass-plus"></i></button>
                </div>
                <div id="viewer" class="escala-viewer custom-scrollbar bg-slate-950 flex items-center justify-center relative">
                    <div id="no-file" class="text-center p-10">
                        <i class="fa-solid fa-file-invoice text-slate-800 text-6xl mb-4"></i>
                        <p class="text-slate-600 text-xs font-bold uppercase">Nenhuma escala carregada</p>
                    </div>
                    <img id="imgEscala" class="hidden w-full h-auto">
                    <iframe id="pdfEscala" class="hidden w-full h-full border-none"></iframe>
                </div>
            </div>

            <div class="lg:col-span-7 flex flex-col gap-6 overflow-hidden">
                
                <div class="glass-panel p-6 rounded-[32px]">
                    <div class="flex items-center gap-2 mb-4 text-amber-500">
                        <i class="fa-solid fa-microchip animate-pulse"></i>
                        <span class="text-[10px] font-black uppercase tracking-widest">Processador de Linguagem Natural</span>
                    </div>
                    <textarea id="textoIA" 
                        placeholder="Cole aqui a mensagem do WhatsApp: 'Dra. Kelly vai no lugar da Dra. Souza dia 15/02...'"
                        class="w-full bg-transparent text-white text-lg font-medium outline-none placeholder:text-slate-600 resize-none"
                        rows="2"></textarea>
                    <div class="flex justify-end mt-2">
                        <button onclick="processarIA()" class="bg-white text-slate-900 px-8 py-3 rounded-full font-black text-xs uppercase tracking-widest hover:bg-amber-500 transition-all active:scale-95">
                            Processar Troca
                        </button>
                    </div>
                </div>

                <div class="flex-grow flex flex-col overflow-hidden">
                    <h3 class="text-[10px] font-black text-slate-500 uppercase tracking-[0.3em] mb-4 ml-2">Histórico Inteligente</h3>
                    <div id="listaTrocas" class="flex-grow overflow-y-auto custom-scrollbar space-y-3 pr-2">
                        </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        let trocas = JSON.parse(localStorage.getItem('cad_v8')) || [];

        function uploadEscala(input) {
            const file = input.files[0];
            const reader = new FileReader();
            reader.onload = (e) => {
                localStorage.setItem('cad_file_v8', e.target.result);
                localStorage.setItem('cad_type_v8', file.type);
                renderEscala();
            };
            reader.readAsDataURL(file);
        }

        function renderEscala() {
            const file = localStorage.getItem('cad_file_v8');
            const type = localStorage.getItem('cad_type_v8');
            if(!file) return;

            document.getElementById('no-file').classList.add('hidden');
            if(type.includes('image')) {
                const img = document.getElementById('imgEscala');
                img.src = file;
                img.classList.remove('hidden');
                document.getElementById('pdfEscala').classList.add('hidden');
            } else {
                const pdf = document.getElementById('pdfEscala');
                pdf.src = file;
                pdf.classList.remove('hidden');
                document.getElementById('imgEscala').classList.add('hidden');
            }
        }

        function processarIA() {
            const txt = document.getElementById('textoIA').value;
            if(!txt) return;

            // IA: Busca por Doutores/Doutoras e Datas
            const regexNomes = /(?:Dra?\.\s?)([A-ZÀ-Ú][a-zà-ú]+(?:\s[A-ZÀ-Ú][a-zà-ú]+)*)/g;
            const matches = [...txt.matchAll(regexNomes)];
            const dataMatch = txt.match(/(\d{1,2}\/\d{1,2})/);

            let sainte = "Advogada?";
            let entrante = "Advogada?";

            if(matches.length >= 2) {
                // Lógica de contexto
                const lowerTxt = txt.toLowerCase();
                if(lowerTxt.indexOf(matches[0][1].toLowerCase()) < lowerTxt.indexOf("no lugar de") || lowerTxt.includes("substitui")) {
                    entrante = "Dra. " + matches[0][1];
                    sainte = "Dra. " + matches[1][1];
                } else {
                    sainte = "Dra. " + matches[0][1];
                    entrante = "Dra. " + matches[1][1];
                }
            }

            const nova = {
                id: Date.now(),
                data: dataMatch ? dataMatch[0] : "DATA",
                sainte,
                entrante,
                hora: new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'})
            };

            trocas.unshift(nova);
            localStorage.setItem('cad_v8', JSON.stringify(trocas));
            document.getElementById('textoIA').value = "";
            renderTrocas();
        }

        function renderTrocas() {
            const container = document.getElementById('listaTrocas');
            container.innerHTML = trocas.length ? '' : '<div class="text-slate-700 text-center mt-20 font-black italic">SISTEMA AGUARDANDO COMANDOS...</div>';

            trocas.forEach(t => {
                container.innerHTML += `
                    <div class="card-troca glass-panel p-5 rounded-3xl flex items-center justify-between border-l-4 border-amber-500">
                        <div class="flex items-center gap-6">
                            <div class="text-center">
                                <span class="text-[9px] font-black text-slate-500 uppercase block">FEV</span>
                                <span class="text-xl font-black text-white">${t.data}</span>
                            </div>
                            <div class="h-10 w-px bg-slate-800"></div>
                            <div class="flex items-center gap-4">
                                <div class="opacity-40">
                                    <span class="text-[8px] font-bold text-red-500 uppercase block">Sai</span>
                                    <span class="text-sm font-bold"><s>${t.sainte}</s></span>
                                </div>
                                <i class="fa-solid fa-angles-right text-amber-500 text-xs"></i>
                                <div>
                                    <span class="text-[8px] font-bold text-emerald-400 uppercase block">Assume</span>
                                    <span class="text-sm font-black text-white uppercase">${t.entrante}</span>
                                </div>
                            </div>
                        </div>
                        <button onclick="excluir(${t.id})" class="text-slate-600 hover:text-red-500 transition-all"><i class="fa-solid fa-circle-xmark"></i></button>
                    </div>
                `;
            });
        }

        function excluir(id) {
            trocas = trocas.filter(x => x.id !== id);
            localStorage.setItem('cad_v8', JSON.stringify(trocas));
            renderTrocas();
        }

        function zoomEscala() {
            const img = document.getElementById('imgEscala').src;
            if(img) window.open(img);
        }

        setInterval(() => {
            const d = new Date();
            document.getElementById('relogio').innerText = d.toLocaleDateString('pt-BR') + ' • ' + d.toLocaleTimeString('pt-BR');
        }, 1000);

        renderEscala();
        renderTrocas();
    </script>
</body>
</html>
