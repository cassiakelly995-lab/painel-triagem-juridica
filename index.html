<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAD Santana de Parnaíba - Inteligência Jurídica</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #f8fafc; }
        .split-view { height: calc(100vh - 100px); }
        .escala-box { background: #020617; border: 2px solid #1e293b; border-radius: 24px; overflow: auto; }
        .glass-input { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .card-substituicao { border-left: 4px solid #f59e0b; background: rgba(30, 41, 59, 0.4); transition: 0.3s; }
        .card-substituicao:hover { background: rgba(30, 41, 59, 0.8); transform: scale(1.01); }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
    </style>
</head>
<body class="overflow-hidden">

    <header class="h-20 flex items-center px-8 border-b border-slate-800">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center gap-4">
                <div class="bg-amber-500 text-slate-900 p-2 rounded-lg"><i class="fa-solid fa-scale-balanced text-xl"></i></div>
                <div>
                    <h1 class="text-lg font-black uppercase tracking-tighter">Comissão de Dativos</h1>
                    <p class="text-amber-500 text-[9px] font-bold tracking-[0.3em] uppercase">Santana de Parnaíba</p>
                </div>
            </div>
            <div class="flex gap-4">
                <input type="file" id="upEscala" class="hidden" onchange="uploadFile(this)">
                <label for="upEscala" class="cursor-pointer bg-slate-800 hover:bg-slate-700 px-4 py-2 rounded-full text-[10px] font-black uppercase border border-slate-700 transition-all">
                    <i class="fa-solid fa-upload mr-2"></i> Subir Escala
                </label>
            </div>
        </div>
    </header>

    <main class="container mx-auto p-6 split-view grid grid-cols-1 lg:grid-cols-12 gap-6">
        
        <div class="lg:col-span-6 flex flex-col gap-3">
            <div class="flex justify-between items-center px-2">
                <span class="text-[10px] font-black text-slate-500 uppercase tracking-widest">Escala Vigente (Consulta)</span>
            </div>
            <div id="viewer" class="escala-box h-full flex items-center justify-center relative">
                <div id="msg-vazio" class="text-center opacity-20">
                    <i class="fa-solid fa-file-pdf text-6xl mb-4"></i>
                    <p class="text-xs font-bold uppercase">Aguardando Escala</p>
                </div>
                <img id="imgEscala" class="hidden w-full h-auto">
                <iframe id="pdfEscala" class="hidden w-full h-full border-none"></iframe>
            </div>
        </div>

        <div class="lg:col-span-6 flex flex-col gap-6 overflow-hidden">
            
            <div class="glass-input p-6 rounded-[32px]">
                <h2 class="text-[10px] font-black text-amber-500 uppercase tracking-widest mb-4 italic">Processador Inteligente de Trocas</h2>
                <textarea id="textoIA" 
                    placeholder="Cole a mensagem: Ex: 'Dra. Paula vai no lugar da Dra. Silvia no dia 20/02'"
                    class="w-full bg-transparent text-white text-lg font-medium outline-none placeholder:text-slate-600 resize-none mb-4"></textarea>
                <div class="flex justify-end">
                    <button onclick="registrarTroca()" class="bg-white text-slate-900 px-10 py-3 rounded-full font-black text-xs uppercase tracking-widest hover:bg-amber-500 transition-all shadow-xl">
                        Registrar na Lista
                    </button>
                </div>
            </div>

            <div class="flex-grow overflow-y-auto pr-2 space-y-3">
                <h3 class="text-[10px] font-black text-slate-500 uppercase tracking-[0.3em] mb-4">Substituições Confirmadas</h3>
                <div id="containerTrocas" class="space-y-4">
                    </div>
            </div>
        </div>
    </main>

    <script>
        let db = JSON.parse(localStorage.getItem('cad_v10')) || [];

        function uploadFile(input) {
            const file = input.files[0];
            const reader = new FileReader();
            reader.onload = (e) => {
                localStorage.setItem('cad_file_v10', e.target.result);
                localStorage.setItem('cad_type_v10', file.type);
                renderEscala();
            };
            reader.readAsDataURL(file);
        }

        function renderEscala() {
            const file = localStorage.getItem('cad_file_v10');
            const type = localStorage.getItem('cad_type_v10');
            if(!file) return;
            document.getElementById('msg-vazio').style.display = 'none';
            if(type.includes('image')) {
                const img = document.getElementById('imgEscala');
                img.src = file; img.classList.remove('hidden');
            } else {
                const pdf = document.getElementById('pdfEscala');
                pdf.src = file; pdf.classList.remove('hidden');
            }
        }

        function registrarTroca() {
            const txt = document.getElementById('textoIA').value;
            if(!txt) return;

            // IA: Identifica Advogadas e Datas
            const regexNomes = /(?:Dra?\.\s?)([A-ZÀ-Ú][a-zà-ú]+(?:\s[A-ZÀ-Ú][a-zà-ú]+)*)/g;
            const matches = [...txt.matchAll(regexNomes)];
            const dataMatch = txt.match(/(\d{1,2}\/\d{1,2})/);

            let sainte = "---";
            let entrante = "---";

            if(matches.length >= 2) {
                // Se o texto diz "vai no lugar de", "entra por", "substitui"
                // O primeiro nome mencionado é quem assume (entrante)
                entrante = "Dra. " + matches[0][1];
                sainte = "Dra. " + matches[1][1];
            }

            const nova = {
                id: Date.now(),
                data: dataMatch ? dataMatch[0] : "DATA?",
                sainte,
                entrante
            };

            db.unshift(nova);
            localStorage.setItem('cad_v10', JSON.stringify(db));
            document.getElementById('textoIA').value = "";
            renderTrocas();
        }

        function renderTrocas() {
            const container = document.getElementById('containerTrocas');
            container.innerHTML = db.length ? '' : '<p class="text-slate-700 font-bold italic text-center py-10">NENHUMA TROCA REGISTRADA</p>';

            db.forEach(t => {
                container.innerHTML += `
                    <div class="card-substituicao p-6 rounded-3xl flex items-center justify-between">
                        <div class="flex items-center gap-6">
                            <div class="bg-slate-900 px-4 py-2 rounded-xl border border-slate-700">
                                <span class="text-[9px] font-black text-amber-500 uppercase block">DIA</span>
                                <span class="text-xl font-black">${t.data}</span>
                            </div>
                            <div class="flex flex-col">
                                <span class="text-[8px] font-bold text-slate-500 uppercase">Sai do Plantão</span>
                                <span class="text-sm font-medium text-slate-400"><s>${t.sainte}</s></span>
                            </div>
                            <i class="fa-solid fa-right-long text-amber-500 opacity-50"></i>
                            <div class="flex flex-col">
                                <span class="text-[8px] font-black text-emerald-400 uppercase tracking-widest animate-pulse">Vai no Lugar</span>
                                <span class="text-lg font-black text-white uppercase">${t.entrante}</span>
                            </div>
                        </div>
                        <button onclick="excluir(${t.id})" class="text-slate-600 hover:text-red-500 transition-all ml-4">
                            <i class="fa-solid fa-trash-can"></i>
                        </button>
                    </div>
                `;
            });
        }

        function excluir(id) {
            db = db.filter(x => x.id !== id);
            localStorage.setItem('cad_v10', JSON.stringify(db));
            renderTrocas();
        }

        renderEscala();
        renderTrocas();
    </script>
</body>
</html>
