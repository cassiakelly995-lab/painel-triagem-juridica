<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAD Santana de Parnaíba | Triagem Inteligente</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #f4f7fa; color: #1e293b; height: 100vh; overflow: hidden; }
        .escala-view { background: #ffffff; border: 2px dashed #cbd5e1; border-radius: 24px; height: 100%; overflow: auto; transition: 0.3s; position: relative; }
        .escala-view:hover { border-color: #f59e0b; background: #fffcf5; }
        .glass-card { background: #ffffff; border-radius: 24px; border: 1px solid #e2e8f0; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.05); }
        .badge-data { background: #0f172a; color: #fbbf24; padding: 4px 12px; border-radius: 8px; font-weight: 800; font-size: 14px; }
        .card-troca { background: #ffffff; border-radius: 20px; border: 1px solid #e2e8f0; transition: 0.3s; position: relative; overflow: hidden; }
        .card-troca:hover { transform: translateY(-3px); box-shadow: 0 12px 20px -5px rgba(0,0,0,0.1); }
        .seta-troca { color: #f59e0b; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
    </style>
</head>
<body class="p-4 md:p-6 flex flex-col">

    <header class="flex justify-between items-center mb-6">
        <div class="flex items-center gap-4">
            <div class="bg-slate-900 p-3 rounded-2xl text-amber-400 shadow-xl shadow-slate-900/20">
                <i class="fa-solid fa-scale-balanced text-xl"></i>
            </div>
            <div>
                <h1 class="text-lg font-extrabold uppercase tracking-tighter leading-none">CAD Santana de Parnaíba</h1>
                <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">Gestão de Triagem • Cássia</p>
            </div>
        </div>
        <div class="flex gap-3">
            <input type="file" id="upEscala" class="hidden" accept="image/*" onchange="uploadLocal(this)">
            <button onclick="document.getElementById('upEscala').click()" class="bg-amber-500 text-black px-6 py-2.5 rounded-full text-[11px] font-black uppercase shadow-lg shadow-amber-500/30 hover:bg-amber-400 transition-all flex items-center gap-2">
                <i class="fa-solid fa-cloud-arrow-up"></i> Upload da Escala
            </button>
        </div>
    </header>

    <main class="flex-grow grid grid-cols-1 lg:grid-cols-12 gap-8 overflow-hidden">
        
        <div class="lg:col-span-6 flex flex-col gap-3 h-full">
            <div class="flex items-center justify-between px-2 text-[10px] font-black text-slate-400 uppercase tracking-widest">
                <span>Documento de Referência</span>
                <span id="statusEscala" class="text-emerald-500 hidden"><i class="fa-solid fa-circle-check"></i> Escala Ativa</span>
            </div>
            <div class="escala-view flex items-center justify-center overflow-hidden">
                <div id="placeholder" class="text-center p-10 pointer-events-none">
                    <div class="bg-slate-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4 border border-slate-200">
                        <i class="fa-solid fa-image text-slate-300 text-3xl"></i>
                    </div>
                    <p class="text-xs font-bold text-slate-500 uppercase">Aguardando arquivo da escala...</p>
                    <p class="text-[10px] text-slate-400 mt-2 uppercase">Clique no botão "Upload" no topo</p>
                </div>
                <img id="imgEscala" class="hidden w-full h-auto object-contain">
            </div>
        </div>

        <div class="lg:col-span-6 flex flex-col gap-6 overflow-hidden">
            
            <div class="glass-card p-6">
                <div class="flex items-center gap-2 mb-4 text-[10px] font-black text-amber-600 uppercase tracking-widest">
                    <i class="fa-solid fa-bolt"></i> Registro Inteligente
                </div>
                <textarea id="entradaIA" rows="2" 
                    placeholder="Dra. Paula substitui Dra. Silvia no dia 15/02..."
                    class="w-full text-lg font-semibold text-slate-800 outline-none placeholder:text-slate-300 resize-none mb-4"></textarea>
                <div class="flex justify-between items-center border-t pt-4">
                    <span class="text-[9px] text-slate-400 font-bold uppercase italic">A IA identificará quem entra e quem sai</span>
                    <button onclick="registrar()" class="bg-slate-900 text-white px-8 py-3 rounded-xl font-black text-xs uppercase tracking-widest hover:bg-amber-500 hover:text-black transition-all shadow-xl active:scale-95">
                        Registrar Troca
                    </button>
                </div>
            </div>

            <div class="flex-grow overflow-y-auto space-y-4 pr-2">
                <div class="flex justify-between items-center mb-2 px-1">
                    <h3 class="text-[10px] font-black text-slate-400 uppercase tracking-widest italic">Substituições Confirmadas</h3>
                    <button onclick="resetar()" class="text-[9px] font-bold text-red-400 hover:text-red-600 uppercase">Limpar Histórico</button>
                </div>
                <div id="lista" class="space-y-4">
                    </div>
            </div>
        </div>
    </main>

    <script>
        let db = JSON.parse(localStorage.getItem('cad_v20')) || [];

        // Função de Upload Local
        function uploadLocal(input) {
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                localStorage.setItem('escala_temp', e.target.result);
                exibirEscala();
            };
            reader.readAsDataURL(file);
        }

        function exibirEscala() {
            const data = localStorage.getItem('escala_temp');
            if (data) {
                document.getElementById('placeholder').style.display = 'none';
                document.getElementById('statusEscala').classList.remove('hidden');
                const img = document.getElementById('imgEscala');
                img.src = data;
                img.classList.remove('hidden');
            }
        }

        // IA de Registro Interativo
        function registrar() {
            const txt = document.getElementById('entradaIA').value;
            if (!txt) return;

            const nomes = [...txt.matchAll(/(?:Dra?\.\s?)([A-ZÀ-Ú][a-zà-ú]+(?:\s[A-ZÀ-Ú][a-zà-ú]+)*)/g)];
            const dataMatch = txt.match(/(\d{1,2}\/\d{1,2})/);

            if (nomes.length >= 2 && dataMatch) {
                // Lógica Interativa: No texto de troca, a primeira citada assume, a segunda sai
                // Ex: "Paula substitui Silvia" -> Paula ENTRA, Silvia SAI.
                addTroca(dataMatch[0], "Dra. " + nomes[1][1], "Dra. " + nomes[0][1]);
                document.getElementById('entradaIA').value = "";
            } else {
                alert("Erro na Identificação: Mencione os dois nomes e a data (Ex: 15/02)");
            }
        }

        function addTroca(dia, sainte, entrante) {
            db.unshift({ id: Date.now(), dia, sainte, entrante });
            localStorage.setItem('cad_v20', JSON.stringify(db));
            render();
        }

        function render() {
            const c = document.getElementById('lista');
            c.innerHTML = db.length ? '' : '<div class="py-20 text-center opacity-20 font-black uppercase tracking-widest text-xs">Sem trocas registradas</div>';

            db.forEach(t => {
                c.innerHTML += `
                    <div class="card-troca p-5 shadow-sm border-l-[6px] border-amber-500">
                        <div class="flex items-center justify-between mb-4">
                            <span class="badge-data">${t.dia}</span>
                            <button onclick="del(${t.id})" class="text-slate-300 hover:text-red-500 transition-all"><i class="fa-solid fa-trash-can"></i></button>
                        </div>
                        <div class="flex items-center justify-around gap-4 text-center">
                            <div class="flex flex-col">
                                <span class="text-[9px] font-black text-slate-400 uppercase mb-1">Sai do Plantão</span>
                                <span class="text-sm font-bold text-slate-400 italic"><s>${t.sainte}</s></span>
                            </div>
                            <div class="seta-troca text-xl">
                                <i class="fa-solid fa-arrow-right-arrow-left"></i>
                            </div>
                            <div class="flex flex-col">
                                <span class="text-[9px] font-black text-emerald-500 uppercase mb-1 tracking-widest">Assume o Lugar</span>
                                <span class="text-base font-black text-slate-900 uppercase underline decoration-emerald-400 decoration-2">${t.entrante}</span>
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        function del(id) {
            db = db.filter(x => x.id !== id);
            localStorage.setItem('cad_v20', JSON.stringify(db));
            render();
        }

        function resetar() {
            if(confirm("Deseja apagar todo o histórico de trocas?")) {
                db = []; localStorage.removeItem('cad_v20'); render();
            }
        }

        window.onload = () => { exibirEscala(); render(); };
    </script>
</body>
</html>
