<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√ÅSSIA PROMPT V8 | CAD ELITE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&family=Cormorant+Garamond:ital,wght@0,600;1,400&display=swap');
        :root { --oab-dark: #070b14; --oab-gold: #c5a36b; --oab-card: #111827; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: var(--oab-dark); color: #f1f5f9; }
        .gold-gradient { background: linear-gradient(135deg, #c5a36b 0%, #f1dca7 50%, #c5a36b 100%); }
        .glass-card { background: var(--oab-card); border: 1px solid rgba(197, 163, 107, 0.2); border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .input-oab { background: #0b121f; border: 1px solid rgba(197, 163, 107, 0.3); border-radius: 8px; padding: 12px; color: white; width: 100%; margin-bottom: 10px; outline: none; transition: 0.3s; }
        .input-oab:focus { border-color: var(--oab-gold); box-shadow: 0 0 10px rgba(197, 163, 107, 0.2); }
        .btn-gold { background: var(--oab-gold); color: #000; font-weight: 800; text-transform: uppercase; padding: 12px; border-radius: 8px; cursor: pointer; border: none; }
        .admin-section { display: none; }
        .is-admin .admin-section { display: block; }
        .log-item { background: rgba(255,255,255,0.03); border-left: 4px solid var(--oab-gold); padding: 12px; margin-bottom: 10px; border-radius: 8px; }
        .falta-item { border-left-color: #ef4444; background: rgba(239, 68, 68, 0.05); }
        footer { font-size: 10px; text-align: center; padding: 20px; opacity: 0.5; color: #fff; line-height: 1.6; }

        /* ‚îÄ‚îÄ TAB NAVIGATION ‚îÄ‚îÄ */
        .tab-nav {
            display: flex;
            gap: 4px;
            background: rgba(255,255,255,0.03);
            padding: 4px;
            border-radius: 12px;
            border: 1px solid rgba(197,163,107,0.15);
        }
        .tab-btn {
            flex: 1;
            padding: 10px 16px;
            border: none;
            border-radius: 9px;
            font-family: 'Plus Jakarta Sans', sans-serif;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            cursor: pointer;
            transition: all 0.25s ease;
            background: transparent;
            color: #64748b;
        }
        .tab-btn.active {
            background: linear-gradient(135deg, #c5a36b, #f1dca7);
            color: #000;
            box-shadow: 0 4px 15px rgba(197,163,107,0.3);
        }
        .tab-btn:not(.active):hover { color: #c5a36b; background: rgba(197,163,107,0.08); }

        .tab-content { display: none; animation: fadeIn 0.3s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }

        /* ‚îÄ‚îÄ ASSIST√äNCIA CARDS ‚îÄ‚îÄ */
        .info-card {
            background: #0d1525;
            border: 1px solid rgba(197,163,107,0.15);
            border-radius: 14px;
            padding: 20px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .info-card:hover { border-color: rgba(197,163,107,0.4); box-shadow: 0 6px 24px rgba(197,163,107,0.08); }
        .info-card-title {
            font-size: 10px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: #c5a36b;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 14px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(197,163,107,0.12);
        }
        .convenio-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 9px 0;
            border-bottom: 1px solid rgba(255,255,255,0.04);
            font-size: 12px;
        }
        .convenio-row:last-child { border-bottom: none; }
        .convenio-label { color: #94a3b8; }
        .convenio-value { color: #f1dca7; font-weight: 600; }
        .contact-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            border-radius: 10px;
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(255,255,255,0.04);
            margin-bottom: 8px;
            transition: background 0.2s;
        }
        .contact-item:hover { background: rgba(197,163,107,0.06); }
        .contact-avatar {
            width: 38px; height: 38px; border-radius: 50%;
            background: linear-gradient(135deg, #1e2d45, #2a3f60);
            border: 1px solid rgba(197,163,107,0.3);
            display: flex; align-items: center; justify-content: center;
            font-size: 13px; color: #c5a36b;
            flex-shrink: 0;
        }
        .contact-name { font-size: 12px; font-weight: 600; color: #f1f5f9; }
        .contact-role { font-size: 10px; color: #64748b; margin-top: 1px; }
        .contact-phone { font-size: 10px; color: #c5a36b; margin-top: 2px; }
        .doc-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 10px;
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(255,255,255,0.05);
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
        }
        .doc-item:hover { background: rgba(197,163,107,0.08); border-color: rgba(197,163,107,0.3); }
        .doc-icon {
            width: 36px; height: 36px; border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-size: 14px; flex-shrink: 0;
        }
        .doc-name { font-size: 12px; font-weight: 600; color: #f1f5f9; }
        .doc-desc { font-size: 10px; color: #64748b; margin-top: 2px; }
        .aviso-item {
            padding: 14px 16px;
            border-radius: 12px;
            border-left: 3px solid;
            margin-bottom: 10px;
            font-size: 12px;
            position: relative;
        }
        .aviso-info { border-left-color: #3b82f6; background: rgba(59,130,246,0.06); }
        .aviso-alerta { border-left-color: #f59e0b; background: rgba(245,158,11,0.06); }
        .aviso-urgente { border-left-color: #ef4444; background: rgba(239,68,68,0.06); }
        .aviso-ok { border-left-color: #10b981; background: rgba(16,185,129,0.06); }
        .aviso-badge {
            display: inline-block;
            font-size: 8px;
            font-weight: 800;
            text-transform: uppercase;
            padding: 2px 7px;
            border-radius: 99px;
            margin-bottom: 5px;
            letter-spacing: 0.08em;
        }
        .badge-info { background: rgba(59,130,246,0.2); color: #93c5fd; }
        .badge-alerta { background: rgba(245,158,11,0.2); color: #fcd34d; }
        .badge-urgente { background: rgba(239,68,68,0.2); color: #fca5a5; }
        .badge-ok { background: rgba(16,185,129,0.2); color: #6ee7b7; }
        .aviso-text { color: #cbd5e1; line-height: 1.5; }
        .aviso-data { font-size: 9px; color: #475569; margin-top: 5px; }

        .edit-input {
            background: #0b121f;
            border: 1px solid rgba(197,163,107,0.3);
            border-radius: 6px;
            padding: 8px 10px;
            color: white;
            font-family: 'Plus Jakarta Sans', sans-serif;
            font-size: 12px;
            outline: none;
            transition: 0.2s;
        }
        .edit-input:focus { border-color: #c5a36b; }
        .edit-select {
            background: #0b121f;
            border: 1px solid rgba(197,163,107,0.3);
            border-radius: 6px;
            padding: 8px 10px;
            color: white;
            font-size: 12px;
            outline: none;
        }
        .btn-sm {
            padding: 6px 14px;
            border-radius: 7px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            cursor: pointer;
            border: none;
            letter-spacing: 0.05em;
        }
        .btn-add { background: #c5a36b; color: #000; }
        .btn-del { background: rgba(239,68,68,0.15); color: #f87171; border: 1px solid rgba(239,68,68,0.2); }
        .btn-del:hover { background: rgba(239,68,68,0.3); }

        .stat-card {
            background: linear-gradient(135deg, #0d1525, #111c30);
            border: 1px solid rgba(197,163,107,0.2);
            border-radius: 14px;
            padding: 18px 20px;
            display: flex;
            align-items: center;
            gap: 14px;
        }
        .stat-icon {
            width: 46px; height: 46px;
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }
        .stat-value { font-size: 22px; font-weight: 800; color: #f1dca7; line-height: 1; }
        .stat-label { font-size: 10px; color: #64748b; margin-top: 3px; text-transform: uppercase; letter-spacing: 0.08em; }

        .section-divider {
            display: flex; align-items: center; gap: 12px;
            margin: 24px 0 16px;
        }
        .section-divider span {
            font-size: 9px; font-weight: 800; text-transform: uppercase;
            letter-spacing: 0.2em; color: #c5a36b; white-space: nowrap;
        }
        .section-divider::before, .section-divider::after {
            content: ''; flex: 1; height: 1px;
            background: linear-gradient(90deg, transparent, rgba(197,163,107,0.3), transparent);
        }
    </style>
</head>
<body id="mainApp">

    <header class="p-6 border-b border-[#c5a36b]/30 bg-[#0f172a] sticky top-0 z-50">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-12 h-12 gold-gradient rounded-lg flex items-center justify-center shadow-lg shadow-gold/20">
                    <i class="fa-solid fa-scale-balanced text-black text-xl"></i>
                </div>
                <div>
                    <h1 class="font-black text-xl tracking-tighter italic uppercase text-white">Painel CAD <span class="text-[#c5a36b]">V8</span></h1>
                    <p class="text-[10px] uppercase tracking-widest text-[#c5a36b] font-bold">Presidente da CAD Maristela Gon√ßalves</p>
                    <p class="text-[8px] uppercase tracking-[3px] text-slate-400">Santana de Parna√≠ba</p>
                </div>
            </div>
            <button onclick="fazerLogin()" class="opacity-20 hover:opacity-100 transition-opacity"><i class="fa-solid fa-user-tie"></i></button>
        </div>
    </header>

    <!-- TAB NAVIGATION -->
    <div class="max-w-6xl mx-auto px-4 pt-5 pb-1">
        <div class="tab-nav">
            <button class="tab-btn active" onclick="trocarAba('plantao', this)">
                <i class="fa-solid fa-calendar-check mr-2"></i>Plant√£o CAD
            </button>
            <button class="tab-btn" onclick="trocarAba('assistencia', this)">
                <i class="fa-solid fa-handshake mr-2"></i>Assist√™ncia & Conv√™nio
            </button>
            <button class="tab-btn" onclick="trocarAba('contatos', this)">
                <i class="fa-solid fa-address-book mr-2"></i>Comiss√£o
            </button>
            <button class="tab-btn" onclick="trocarAba('avisos', this)">
                <i class="fa-solid fa-bell mr-2"></i>Avisos
                <span id="badgeAvisos" class="hidden ml-1 bg-red-500 text-white text-[8px] font-black px-1.5 py-0.5 rounded-full"></span>
            </button>
        </div>
    </div>

    <main class="max-w-6xl mx-auto p-4">

        <!-- ABA 1 ¬∑ PLANT√ÉO (ORIGINAL) -->
        <div id="tab-plantao" class="tab-content active">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2">
                    <div class="glass-card overflow-hidden">
                        <div class="p-4 border-b border-white/5 flex justify-between items-center bg-white/5">
                            <h3 class="font-bold text-sm uppercase flex items-center gap-2">
                                <i class="fa-solid fa-calendar-check text-[#c5a36b]"></i> Escala de Plant√£o CAD
                            </h3>
                        </div>
                        <div id="containerEscala" class="min-h-[400px] flex items-center justify-center bg-black/20">
                            <p class="text-slate-500 italic">Conectando ao banco de dados...</p>
                        </div>
                    </div>
                </div>

                <div class="space-y-6">
                    <div class="glass-card p-6">
                        <div class="admin-section border-b border-white/10 pb-6 mb-6">
                            <span class="text-[10px] font-black text-[#c5a36b] uppercase block mb-4 tracking-widest text-center">Gest√£o da Presid√™ncia CAD</span>
                            <input type="file" id="fileIn" class="hidden" accept="image/*" onchange="uploadEscala(this)">
                            <button onclick="document.getElementById('fileIn').click()" class="btn-gold w-full mb-4">
                                <i class="fa-solid fa-image mr-2"></i>ATUALIZAR ESCALA OFICIAL
                            </button>
                            <div class="space-y-2">
                                <input type="text" id="dataTroca" placeholder="Data (Ex: 17/02)" class="input-oab">
                                <input type="text" id="advSai" placeholder="Advogado(a) que SAI" class="input-oab">
                                <input type="text" id="advEntra" placeholder="Advogado(a) que ENTRA" class="input-oab">
                                <div class="grid grid-cols-2 gap-2">
                                    <button onclick="registrar('T')" class="btn-gold text-[11px]">REGISTRAR TROCA</button>
                                    <button onclick="registrar('F')" class="bg-red-700 hover:bg-red-800 text-white font-bold p-3 rounded-lg text-[11px] uppercase">FALTA</button>
                                </div>
                            </div>
                            <button onclick="exportarExcel()" class="w-full mt-4 bg-emerald-700 text-white p-2 rounded-lg text-[10px] font-bold uppercase hover:bg-emerald-600 transition flex items-center justify-center gap-2">
                                <i class="fa-solid fa-file-excel"></i> Gerar Relat√≥rio CAD
                            </button>
                        </div>
                        <span class="text-[10px] font-black text-[#c5a36b] uppercase block mb-4 tracking-widest border-b border-[#c5a36b]/20 pb-2">Registros da Comiss√£o</span>
                        <div id="listaLogs" class="max-h-[500px] overflow-y-auto space-y-3 pr-2"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ABA 2 ¬∑ ASSIST√äNCIA & CONV√äNIO -->
        <div id="tab-assistencia" class="tab-content">
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <div class="stat-card">
                    <div class="stat-icon" style="background:rgba(197,163,107,0.1)">
                        <i class="fa-solid fa-gavel" style="color:#c5a36b"></i>
                    </div>
                    <div>
                        <div class="stat-value" id="statCasos">‚Äî</div>
                        <div class="stat-label">Casos Ativos</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background:rgba(16,185,129,0.1)">
                        <i class="fa-solid fa-circle-check" style="color:#10b981"></i>
                    </div>
                    <div>
                        <div class="stat-value" id="statEncerrados">‚Äî</div>
                        <div class="stat-label">Encerrados</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background:rgba(59,130,246,0.1)">
                        <i class="fa-solid fa-users" style="color:#3b82f6"></i>
                    </div>
                    <div>
                        <div class="stat-value" id="statMembros">‚Äî</div>
                        <div class="stat-label">Membros CAD</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background:rgba(245,158,11,0.1)">
                        <i class="fa-solid fa-calendar-days" style="color:#f59e0b"></i>
                    </div>
                    <div>
                        <div class="stat-value" id="statVigencia">‚Äî</div>
                        <div class="stat-label">Vig√™ncia</div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="info-card">
                    <div class="info-card-title">
                        <i class="fa-solid fa-file-contract"></i> Informa√ß√µes do Conv√™nio
                        <button onclick="editarConvenio()" class="admin-section ml-auto text-[9px] text-slate-500 hover:text-[#c5a36b] transition">
                            <i class="fa-solid fa-pen"></i> Editar
                        </button>
                    </div>
                    <div id="listaConvenio"></div>
                </div>

                <div class="info-card">
                    <div class="info-card-title">
                        <i class="fa-solid fa-folder-open"></i> Documentos & Formul√°rios
                        <button onclick="adicionarDoc()" class="admin-section ml-auto text-[9px] text-slate-500 hover:text-[#c5a36b] transition">
                            <i class="fa-solid fa-plus"></i> Adicionar
                        </button>
                    </div>
                    <div id="listaDocs"></div>
                </div>
            </div>
        </div>

        <!-- ABA 3 ¬∑ COMISS√ÉO -->
        <div id="tab-contatos" class="tab-content">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="info-card">
                    <div class="info-card-title">
                        <i class="fa-solid fa-users-gear"></i> Membros da Comiss√£o
                        <button onclick="adicionarContato()" class="admin-section ml-auto text-[9px] text-slate-500 hover:text-[#c5a36b] transition">
                            <i class="fa-solid fa-plus"></i> Adicionar
                        </button>
                    </div>
                    <div id="listaContatos"></div>
                </div>

                <div class="info-card">
                    <div class="info-card-title">
                        <i class="fa-solid fa-phone-volume"></i> Contatos Institucionais
                        <button onclick="adicionarContInst()" class="admin-section ml-auto text-[9px] text-slate-500 hover:text-[#c5a36b] transition">
                            <i class="fa-solid fa-plus"></i> Adicionar
                        </button>
                    </div>
                    <div id="listaContInst"></div>
                    <div class="section-divider"><span>Sobre a CAD</span></div>
                    <div class="text-[12px] text-slate-400 leading-relaxed" id="textoSobreCAD">
                        A Comiss√£o de Assist√™ncia e Advocacia Dativa de Santana de Parna√≠ba atua em defesa dos cidad√£os que n√£o possuem condi√ß√µes de arcar com honor√°rios advocat√≠cios, garantindo o acesso √† Justi√ßa previsto na Constitui√ß√£o Federal.
                    </div>
                    <button onclick="editarSobre()" class="admin-section mt-3 text-[9px] text-slate-500 hover:text-[#c5a36b] transition">
                        <i class="fa-solid fa-pen"></i> Editar texto
                    </button>
                </div>
            </div>
        </div>

        <!-- ABA 4 ¬∑ AVISOS -->
        <div id="tab-avisos" class="tab-content">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2 info-card">
                    <div class="info-card-title">
                        <i class="fa-solid fa-bullhorn"></i> Comunicados & Avisos
                    </div>
                    <div id="listaAvisos"></div>
                </div>

                <div class="info-card admin-section">
                    <div class="info-card-title">
                        <i class="fa-solid fa-plus-circle"></i> Novo Aviso
                    </div>
                    <div class="space-y-2">
                        <select id="tipoAviso" class="edit-select w-full">
                            <option value="info">‚ÑπÔ∏è Informativo</option>
                            <option value="alerta">‚ö†Ô∏è Alerta</option>
                            <option value="urgente">üî¥ Urgente</option>
                            <option value="ok">‚úÖ OK / Resolvido</option>
                        </select>
                        <input type="text" id="tituloAviso" placeholder="T√≠tulo do aviso" class="edit-input w-full">
                        <textarea id="textoAviso" placeholder="Mensagem..." class="edit-input w-full" rows="4" style="resize:vertical"></textarea>
                        <button onclick="publicarAviso()" class="btn-gold w-full text-[11px]">
                            <i class="fa-solid fa-paper-plane mr-1"></i> PUBLICAR
                        </button>
                    </div>
                </div>

                <div class="info-card" id="avisoPlaceholder">
                    <div class="info-card-title"><i class="fa-solid fa-circle-info"></i> Informa√ß√£o</div>
                    <p class="text-[11px] text-slate-500">Novos comunicados s√£o publicados pela Presid√™ncia da CAD.</p>
                </div>
            </div>
        </div>

    </main>

    <footer>
        <p>A responsabilidade √© de quem est√° usando e o programa apenas gera o prompt.</p>
        <p class="mt-2 text-[#c5a36b] font-bold uppercase">C√°ssia Prompt V8 - Santana de Parna√≠ba ¬© 2026</p>
    </footer>

    <script>
        // FIREBASE CONFIG ORIGINAL
        const firebaseConfig = {
            apiKey: "AIzaSyCBxYwyTieXWmzC_yGq0Abyr5xXZoj-4ts",
            authDomain: "cassia-assistencia-v8.firebaseapp.com",
            projectId: "cassia-assistencia-v8",
            storageBucket: "cassia-assistencia-v8.firebasestorage.app",
            messagingSenderId: "1082407112672",
            appId: "1:1082407112672:web:ea69563be63a9bd8036585",
            databaseURL: "https://cassia-assistencia-v8-default-rtdb.firebaseio.com/"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // LOGIN ORIGINAL
        function fazerLogin() {
            if(prompt("Senha Master CAD:") === "CAD2026") {
                document.getElementById('mainApp').classList.add('is-admin');
                document.getElementById('avisoPlaceholder').style.display = 'none';
            }
        }

        // ESCALA ORIGINAL
        function uploadEscala(input) {
            const file = input.files[0];
            const reader = new FileReader();
            reader.onload = (e) => db.ref('escala_v8').set(e.target.result);
            reader.readAsDataURL(file);
        }
        db.ref('escala_v8').on('value', snap => {
            const imgData = snap.val();
            const container = document.getElementById('containerEscala');
            if(imgData) container.innerHTML = `<img src="${imgData}" class="w-full">`;
            else container.innerHTML = `<p class="text-slate-500 italic">Nenhuma escala publicada.</p>`;
        });

        // LOGS ORIGINAL
        function registrar(tipo) {
            const d = document.getElementById('dataTroca').value;
            const s = document.getElementById('advSai').value;
            const e = document.getElementById('advEntra').value;
            if(!d || !s) return alert("Preencha os dados!");
            db.ref('logs_v8').push({ tipo, data: d, saiu: s, entrou: tipo === 'F' ? 'FALTA' : (e || '---'), timestamp: Date.now() });
            document.getElementById('advSai').value = '';
            document.getElementById('advEntra').value = '';
        }
        db.ref('logs_v8').on('value', snap => {
            const lista = document.getElementById('listaLogs');
            lista.innerHTML = '';
            const data = snap.val();
            if(data) {
                Object.keys(data).reverse().forEach(id => {
                    const item = data[id];
                    const isFalta = item.tipo === 'F';
                    lista.innerHTML += `<div class="log-item ${isFalta ? 'falta-item' : ''}">
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-[10px] font-bold text-[#c5a36b]">[ ${item.data} ]</span>
                            <button onclick="apagar('${id}')" class="admin-section text-red-900 text-[10px]">Excluir</button>
                        </div>
                        <div class="text-[11px] uppercase">
                            ${isFalta ? `<b class="text-red-500">FALTA:</b> ${item.saiu}` : `<b>SAIU:</b> ${item.saiu} ‚Üí <b>ENTROU:</b> ${item.entrou}`}
                        </div></div>`;
                });
            }
        });
        function apagar(id) { if(confirm("Excluir?")) db.ref('logs_v8').child(id).remove(); }

        // EXCEL ORIGINAL
        function exportarExcel() {
            db.ref('logs_v8').once('value', snap => {
                const logs = snap.val();
                if(!logs) return alert("Sem dados.");
                const rows = Object.values(logs).map(i => ({
                    "DATA": i.data, "STATUS": i.tipo === 'F' ? 'FALTA' : 'TROCA', "ADV_SAIU": i.saiu, "ADV_ENTROU": i.entrou
                }));
                const ws = XLSX.utils.json_to_sheet(rows);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "CAD");
                XLSX.writeFile(wb, "Relatorio_CAD.xlsx");
            });
        }

        // NAVEGA√á√ÉO DE ABAS
        function trocarAba(aba, btn) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab-' + aba).classList.add('active');
            btn.classList.add('active');
        }

        // CONV√äNIO
        const convenioDefault = [
            { label: "√ìrg√£o Conveniante", value: "OAB Subse√ß√£o Santana de Parna√≠ba" },
            { label: "Convenente", value: "Tribunal de Justi√ßa SP" },
            { label: "Vig√™ncia", value: "‚Äî" },
            { label: "Valor por Ato", value: "‚Äî" },
            { label: "Prazo de Pagamento", value: "‚Äî" },
            { label: "Respons√°vel", value: "Dra. Maristela Gon√ßalves" }
        ];
        db.ref('convenio_v8').on('value', snap => {
            const data = snap.val() || convenioDefault;
            const lista = document.getElementById('listaConvenio');
            lista.innerHTML = data.map(r => `
                <div class="convenio-row">
                    <span class="convenio-label">${r.label}</span>
                    <span class="convenio-value">${r.value}</span>
                </div>`).join('');
            const vig = data.find(r => r.label === 'Vig√™ncia');
            if(vig) document.getElementById('statVigencia').textContent = vig.value !== '‚Äî' ? vig.value.split('/').pop() || '‚Äî' : '‚Äî';
        });
        function editarConvenio() {
            db.ref('convenio_v8').once('value', snap => {
                const data = snap.val() || convenioDefault;
                const modal = criarModal('Editar Conv√™nio');
                const body = modal.querySelector('.modal-body');
                body.innerHTML = data.map((r, i) => `
                    <div class="flex gap-2 mb-2">
                        <input class="edit-input flex-1" value="${r.label}" id="cl${i}">
                        <input class="edit-input flex-1" value="${r.value}" id="cv${i}">
                    </div>`).join('') +
                    `<button onclick="salvarConvenio(${data.length})" class="btn-gold w-full mt-3 btn-sm">Salvar</button>`;
                document.body.appendChild(modal);
            });
        }
        function salvarConvenio(n) {
            const arr = [];
            for(let i=0;i<n;i++) {
                const l = document.getElementById('cl'+i)?.value;
                const v = document.getElementById('cv'+i)?.value;
                if(l) arr.push({label:l, value:v||'‚Äî'});
            }
            db.ref('convenio_v8').set(arr);
            fecharModal();
        }

        // STATS
        db.ref('stats_v8').on('value', snap => {
            const d = snap.val() || {};
            document.getElementById('statCasos').textContent = d.casos || '‚Äî';
            document.getElementById('statEncerrados').textContent = d.encerrados || '‚Äî';
            document.getElementById('statMembros').textContent = d.membros || '‚Äî';
        });

        // DOCUMENTOS
        const iconeDoc = { pdf: '#ef4444', doc: '#3b82f6', link: '#10b981', form: '#f59e0b' };
        const iconeFa  = { pdf: 'fa-file-pdf', doc: 'fa-file-word', link: 'fa-link', form: 'fa-file-lines' };
        db.ref('docs_v8').on('value', snap => {
            const lista = document.getElementById('listaDocs');
            const data = snap.val();
            if(!data) { lista.innerHTML = '<p class="text-[11px] text-slate-600 italic">Nenhum documento cadastrado.</p>'; return; }
            lista.innerHTML = Object.entries(data).reverse().map(([id, d]) => `
                <a href="${d.url || '#'}" target="_blank" class="doc-item">
                    <div class="doc-icon" style="background:${iconeDoc[d.tipo]||'#475569'}22">
                        <i class="fa-solid ${iconeFa[d.tipo]||'fa-file'}" style="color:${iconeDoc[d.tipo]||'#94a3b8'}"></i>
                    </div>
                    <div class="flex-1">
                        <div class="doc-name">${d.nome}</div>
                        <div class="doc-desc">${d.desc || ''}</div>
                    </div>
                    <button onclick="event.preventDefault();apagarDoc('${id}')" class="admin-section text-red-900 text-[10px] ml-2">
                        <i class="fa-solid fa-trash"></i>
                    </button>
                </a>`).join('');
        });
        function adicionarDoc() {
            const modal = criarModal('Novo Documento');
            const body = modal.querySelector('.modal-body');
            body.innerHTML = `
                <input class="edit-input w-full mb-2" id="dNome" placeholder="Nome do documento">
                <input class="edit-input w-full mb-2" id="dDesc" placeholder="Descri√ß√£o curta">
                <input class="edit-input w-full mb-2" id="dUrl" placeholder="Link (URL)">
                <select class="edit-select w-full mb-3" id="dTipo">
                    <option value="pdf">PDF</option>
                    <option value="doc">Word / Doc</option>
                    <option value="link">Link</option>
                    <option value="form">Formul√°rio</option>
                </select>
                <button onclick="salvarDoc()" class="btn-gold w-full btn-sm">Salvar</button>`;
            document.body.appendChild(modal);
        }
        function salvarDoc() {
            const n = document.getElementById('dNome').value;
            if(!n) return alert('Informe o nome.');
            db.ref('docs_v8').push({ nome: n, desc: document.getElementById('dDesc').value, url: document.getElementById('dUrl').value, tipo: document.getElementById('dTipo').value });
            fecharModal();
        }
        function apagarDoc(id) { if(confirm('Remover documento?')) db.ref('docs_v8').child(id).remove(); }

        // CONTATOS
        db.ref('contatos_v8').on('value', snap => {
            const lista = document.getElementById('listaContatos');
            const data = snap.val();
            if(!data) { lista.innerHTML = '<p class="text-[11px] text-slate-600 italic">Nenhum membro cadastrado.</p>'; return; }
            lista.innerHTML = Object.entries(data).map(([id, c]) => `
                <div class="contact-item">
                    <div class="contact-avatar"><i class="fa-solid fa-user-tie"></i></div>
                    <div class="flex-1">
                        <div class="contact-name">${c.nome}</div>
                        <div class="contact-role">${c.cargo || ''}</div>
                        ${c.tel ? `<div class="contact-phone"><i class="fa-solid fa-phone fa-xs mr-1"></i>${c.tel}</div>` : ''}
                    </div>
                    <button onclick="apagarContato('${id}')" class="admin-section text-red-900 text-[10px]"><i class="fa-solid fa-trash"></i></button>
                </div>`).join('');
            document.getElementById('statMembros').textContent = Object.keys(data).length;
        });
        function adicionarContato() {
            const modal = criarModal('Novo Membro');
            const body = modal.querySelector('.modal-body');
            body.innerHTML = `
                <input class="edit-input w-full mb-2" id="cNome" placeholder="Nome completo">
                <input class="edit-input w-full mb-2" id="cCargo" placeholder="Cargo / Fun√ß√£o">
                <input class="edit-input w-full mb-3" id="cTel" placeholder="Telefone">
                <button onclick="salvarContato()" class="btn-gold w-full btn-sm">Salvar</button>`;
            document.body.appendChild(modal);
        }
        function salvarContato() {
            const n = document.getElementById('cNome').value;
            if(!n) return alert('Informe o nome.');
            db.ref('contatos_v8').push({ nome: n, cargo: document.getElementById('cCargo').value, tel: document.getElementById('cTel').value });
            fecharModal();
        }
        function apagarContato(id) { if(confirm('Remover membro?')) db.ref('contatos_v8').child(id).remove(); }

        // CONTATOS INSTITUCIONAIS
        db.ref('contInst_v8').on('value', snap => {
            const lista = document.getElementById('listaContInst');
            const data = snap.val();
            if(!data) { lista.innerHTML = '<p class="text-[11px] text-slate-600 italic">Nenhum contato cadastrado.</p>'; return; }
            lista.innerHTML = Object.entries(data).map(([id, c]) => `
                <div class="contact-item">
                    <div class="contact-avatar" style="background:linear-gradient(135deg,#1a2a1a,#2a402a);border-color:rgba(16,185,129,0.3)">
                        <i class="fa-solid fa-landmark" style="color:#10b981"></i>
                    </div>
                    <div class="flex-1">
                        <div class="contact-name">${c.nome}</div>
                        <div class="contact-role">${c.org || ''}</div>
                        ${c.tel ? `<div class="contact-phone"><i class="fa-solid fa-phone fa-xs mr-1"></i>${c.tel}</div>` : ''}
                    </div>
                    <button onclick="apagarContInst('${id}')" class="admin-section text-red-900 text-[10px]"><i class="fa-solid fa-trash"></i></button>
                </div>`).join('');
        });
        function adicionarContInst() {
            const modal = criarModal('Contato Institucional');
            const body = modal.querySelector('.modal-body');
            body.innerHTML = `
                <input class="edit-input w-full mb-2" id="iNome" placeholder="Nome do contato">
                <input class="edit-input w-full mb-2" id="iOrg" placeholder="Organiza√ß√£o / Tribunal">
                <input class="edit-input w-full mb-3" id="iTel" placeholder="Telefone">
                <button onclick="salvarContInst()" class="btn-gold w-full btn-sm">Salvar</button>`;
            document.body.appendChild(modal);
        }
        function salvarContInst() {
            const n = document.getElementById('iNome').value;
            if(!n) return alert('Informe o nome.');
            db.ref('contInst_v8').push({ nome: n, org: document.getElementById('iOrg').value, tel: document.getElementById('iTel').value });
            fecharModal();
        }
        function apagarContInst(id) { if(confirm('Remover?')) db.ref('contInst_v8').child(id).remove(); }

        // SOBRE A CAD
        db.ref('sobre_v8').on('value', snap => {
            if(snap.val()) document.getElementById('textoSobreCAD').textContent = snap.val();
        });
        function editarSobre() {
            const atual = document.getElementById('textoSobreCAD').textContent;
            const modal = criarModal('Sobre a CAD');
            const body = modal.querySelector('.modal-body');
            body.innerHTML = `<textarea class="edit-input w-full mb-3" rows="6" id="sobreTxt">${atual}</textarea>
                <button onclick="db.ref('sobre_v8').set(document.getElementById('sobreTxt').value);fecharModal()" class="btn-gold w-full btn-sm">Salvar</button>`;
            document.body.appendChild(modal);
        }

        // AVISOS
        const avisoClasses = { info:'aviso-info', alerta:'aviso-alerta', urgente:'aviso-urgente', ok:'aviso-ok' };
        const avisoBadges  = { info:'badge-info',  alerta:'badge-alerta',  urgente:'badge-urgente',  ok:'badge-ok' };
        const avisoLabels  = { info:'Informativo', alerta:'Alerta', urgente:'URGENTE', ok:'Resolvido' };
        db.ref('avisos_v8').on('value', snap => {
            const lista = document.getElementById('listaAvisos');
            const data = snap.val();
            if(!data) { lista.innerHTML = '<p class="text-[11px] text-slate-600 italic">Nenhum aviso publicado.</p>'; return; }
            const entries = Object.entries(data).reverse();
            lista.innerHTML = entries.map(([id, a]) => `
                <div class="aviso-item ${avisoClasses[a.tipo]||'aviso-info'}">
                    <span class="aviso-badge ${avisoBadges[a.tipo]||'badge-info'}">${avisoLabels[a.tipo]||'Info'}</span>
                    <div class="font-bold text-[13px] text-white mb-1">${a.titulo || ''}</div>
                    <div class="aviso-text">${a.texto}</div>
                    <div class="flex justify-between items-center mt-2">
                        <div class="aviso-data">${a.data || ''}</div>
                        <button onclick="apagarAviso('${id}')" class="admin-section text-red-900 text-[9px]"><i class="fa-solid fa-trash"></i></button>
                    </div>
                </div>`).join('');
            const urgentes = entries.filter(([,a]) => a.tipo === 'urgente').length;
            const badge = document.getElementById('badgeAvisos');
            if(urgentes > 0) { badge.textContent = urgentes; badge.classList.remove('hidden'); }
            else badge.classList.add('hidden');
        });
        function publicarAviso() {
            const t = document.getElementById('textoAviso').value;
            const titulo = document.getElementById('tituloAviso').value;
            if(!t) return alert('Escreva a mensagem.');
            const tipo = document.getElementById('tipoAviso').value;
            const agora = new Date();
            const data = agora.toLocaleDateString('pt-BR') + ' ' + agora.toLocaleTimeString('pt-BR', {hour:'2-digit', minute:'2-digit'});
            db.ref('avisos_v8').push({ tipo, titulo, texto: t, data });
            document.getElementById('textoAviso').value = '';
            document.getElementById('tituloAviso').value = '';
        }
        function apagarAviso(id) { if(confirm('Excluir aviso?')) db.ref('avisos_v8').child(id).remove(); }

        // MODAL HELPER
        function criarModal(titulo) {
            const el = document.createElement('div');
            el.id = 'modalCAD';
            el.style.cssText = 'position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,0.75);backdrop-filter:blur(6px);display:flex;align-items:center;justify-content:center;padding:16px';
            el.innerHTML = `<div style="background:#0d1525;border:1px solid rgba(197,163,107,0.3);border-radius:16px;padding:24px;width:100%;max-width:420px;max-height:90vh;overflow-y:auto">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:18px">
                    <span style="font-size:11px;font-weight:800;text-transform:uppercase;letter-spacing:0.15em;color:#c5a36b">${titulo}</span>
                    <button onclick="fecharModal()" style="color:#64748b;font-size:18px;background:none;border:none;cursor:pointer">&times;</button>
                </div>
                <div class="modal-body"></div>
            </div>`;
            el.addEventListener('click', e => { if(e.target === el) fecharModal(); });
            return el;
        }
        function fecharModal() { document.getElementById('modalCAD')?.remove(); }
    </script>
</body>
</html>
