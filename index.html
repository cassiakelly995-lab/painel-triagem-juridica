<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√ÅSSIA PROMPT V8 | CAD ELITE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-storage-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&family=Cormorant+Garamond:ital,wght@0,600;1,400&display=swap');
        :root { --oab-dark: #070b14; --oab-gold: #c5a36b; --oab-card: #111827; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: var(--oab-dark); color: #f1f5f9; }
        .gold-gradient { background: linear-gradient(135deg, #c5a36b 0%, #f1dca7 50%, #c5a36b 100%); }
        .glass-card { background: var(--oab-card); border: 1px solid rgba(197,163,107,0.2); border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .input-oab { background: #0b121f; border: 1px solid rgba(197,163,107,0.3); border-radius: 8px; padding: 12px; color: white; width: 100%; margin-bottom: 10px; outline: none; transition: 0.3s; }
        .input-oab:focus { border-color: var(--oab-gold); box-shadow: 0 0 10px rgba(197,163,107,0.2); }
        .btn-gold { background: var(--oab-gold); color: #000; font-weight: 800; text-transform: uppercase; padding: 12px; border-radius: 8px; cursor: pointer; border: none; width: 100%; display: block; }
        .admin-section { display: none; }
        .is-admin .admin-section { display: block; }
        .is-admin .hide-admin { display: none; }
        .log-item { background: rgba(255,255,255,0.03); border-left: 4px solid var(--oab-gold); padding: 12px; margin-bottom: 10px; border-radius: 8px; }
        .falta-item { border-left-color: #ef4444; background: rgba(239,68,68,0.05); }
        footer { font-size: 10px; text-align: center; padding: 20px; opacity: 0.5; color: #fff; line-height: 1.6; }

        /* TABS */
        .tab-nav { display: flex; gap: 4px; background: rgba(255,255,255,0.03); padding: 4px; border-radius: 12px; border: 1px solid rgba(197,163,107,0.15); flex-wrap: wrap; }
        .tab-btn { flex: 1; min-width: 120px; padding: 10px 12px; border: none; border-radius: 9px; font-family: 'Plus Jakarta Sans', sans-serif; font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; cursor: pointer; transition: all 0.25s ease; background: transparent; color: #64748b; }
        .tab-btn.active { background: linear-gradient(135deg, #c5a36b, #f1dca7); color: #000; box-shadow: 0 4px 15px rgba(197,163,107,0.3); }
        .tab-btn:not(.active):hover { color: #c5a36b; background: rgba(197,163,107,0.08); }
        .tab-content { display: none; animation: fadeIn 0.3s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity:0; transform:translateY(6px); } to { opacity:1; transform:translateY(0); } }

        /* CARDS */
        .info-card { background: #0d1525; border: 1px solid rgba(197,163,107,0.15); border-radius: 14px; padding: 20px; transition: border-color 0.2s, box-shadow 0.2s; }
        .info-card:hover { border-color: rgba(197,163,107,0.35); box-shadow: 0 6px 24px rgba(197,163,107,0.07); }
        .info-card-title { font-size: 10px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.15em; color: #c5a36b; display: flex; align-items: center; gap: 8px; margin-bottom: 14px; padding-bottom: 10px; border-bottom: 1px solid rgba(197,163,107,0.12); }

        /* CONVENIO */
        .convenio-row { display: flex; justify-content: space-between; align-items: center; padding: 9px 0; border-bottom: 1px solid rgba(255,255,255,0.04); font-size: 12px; }
        .convenio-row:last-child { border-bottom: none; }
        .convenio-label { color: #94a3b8; }
        .convenio-value { color: #f1dca7; font-weight: 600; text-align: right; max-width: 55%; }

        /* CONTACTS */
        .contact-item { display: flex; align-items: center; gap: 12px; padding: 10px; border-radius: 10px; background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.04); margin-bottom: 8px; transition: background 0.2s; }
        .contact-item:hover { background: rgba(197,163,107,0.05); }
        .contact-avatar { width: 38px; height: 38px; border-radius: 50%; background: linear-gradient(135deg, #1e2d45, #2a3f60); border: 1px solid rgba(197,163,107,0.3); display: flex; align-items: center; justify-content: center; font-size: 13px; color: #c5a36b; flex-shrink: 0; }
        .contact-name { font-size: 12px; font-weight: 600; color: #f1f5f9; }
        .contact-role { font-size: 10px; color: #64748b; margin-top: 1px; }
        .contact-phone { font-size: 10px; color: #c5a36b; margin-top: 2px; }

        /* DOCS */
        .doc-item { display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: 10px; background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.05); margin-bottom: 8px; cursor: pointer; transition: all 0.2s; text-decoration: none; }
        .doc-item:hover { background: rgba(197,163,107,0.08); border-color: rgba(197,163,107,0.3); }
        .doc-icon { width: 38px; height: 38px; border-radius: 9px; display: flex; align-items: center; justify-content: center; font-size: 15px; flex-shrink: 0; }
        .doc-name { font-size: 12px; font-weight: 600; color: #f1f5f9; }
        .doc-desc { font-size: 10px; color: #64748b; margin-top: 2px; }
        .doc-size { font-size: 9px; color: #475569; margin-top: 3px; }

        /* AVISOS */
        .aviso-item { padding: 14px 16px; border-radius: 12px; border-left: 3px solid; margin-bottom: 10px; font-size: 12px; }
        .aviso-info { border-left-color: #3b82f6; background: rgba(59,130,246,0.06); }
        .aviso-alerta { border-left-color: #f59e0b; background: rgba(245,158,11,0.06); }
        .aviso-urgente { border-left-color: #ef4444; background: rgba(239,68,68,0.06); }
        .aviso-ok { border-left-color: #10b981; background: rgba(16,185,129,0.06); }
        .aviso-badge { display: inline-block; font-size: 8px; font-weight: 800; text-transform: uppercase; padding: 2px 8px; border-radius: 99px; margin-bottom: 5px; letter-spacing: 0.08em; }
        .badge-info { background: rgba(59,130,246,0.2); color: #93c5fd; }
        .badge-alerta { background: rgba(245,158,11,0.2); color: #fcd34d; }
        .badge-urgente { background: rgba(239,68,68,0.2); color: #fca5a5; }
        .badge-ok { background: rgba(16,185,129,0.2); color: #6ee7b7; }
        .aviso-text { color: #cbd5e1; line-height: 1.5; }
        .aviso-data { font-size: 9px; color: #475569; margin-top: 5px; }

        /* STATS */
        .stat-card { background: linear-gradient(135deg, #0d1525, #111c30); border: 1px solid rgba(197,163,107,0.2); border-radius: 14px; padding: 18px 20px; display: flex; align-items: center; gap: 14px; cursor: pointer; transition: border-color 0.2s; }
        .stat-card:hover { border-color: rgba(197,163,107,0.4); }
        .stat-icon { width: 46px; height: 46px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 18px; flex-shrink: 0; }
        .stat-value { font-size: 22px; font-weight: 800; color: #f1dca7; line-height: 1; }
        .stat-label { font-size: 10px; color: #64748b; margin-top: 3px; text-transform: uppercase; letter-spacing: 0.08em; }

        /* INPUTS */
        .edit-input { background: #0b121f; border: 1px solid rgba(197,163,107,0.3); border-radius: 6px; padding: 8px 10px; color: white; font-family: 'Plus Jakarta Sans', sans-serif; font-size: 12px; outline: none; transition: 0.2s; width: 100%; }
        .edit-input:focus { border-color: #c5a36b; }
        .edit-select { background: #0b121f; border: 1px solid rgba(197,163,107,0.3); border-radius: 6px; padding: 8px 10px; color: white; font-size: 12px; outline: none; width: 100%; }
        .btn-sm { padding: 8px 14px; border-radius: 7px; font-size: 10px; font-weight: 700; text-transform: uppercase; cursor: pointer; border: none; letter-spacing: 0.05em; }
        .btn-sm-gold { background: #c5a36b; color: #000; }
        .btn-sm-red { background: rgba(239,68,68,0.15); color: #f87171; border: 1px solid rgba(239,68,68,0.2); }
        .btn-sm-red:hover { background: rgba(239,68,68,0.3); }
        .btn-sm-blue { background: rgba(59,130,246,0.15); color: #93c5fd; border: 1px solid rgba(59,130,246,0.2); }

        /* UPLOAD ZONE */
        .upload-zone { border: 2px dashed rgba(197,163,107,0.3); border-radius: 10px; padding: 24px; text-align: center; cursor: pointer; transition: all 0.2s; background: rgba(197,163,107,0.02); }
        .upload-zone:hover, .upload-zone.dragover { border-color: #c5a36b; background: rgba(197,163,107,0.07); }
        .upload-zone i { font-size: 28px; color: #c5a36b; margin-bottom: 8px; display: block; }
        .upload-zone p { font-size: 11px; color: #64748b; }
        .upload-zone strong { color: #c5a36b; font-size: 12px; }

        /* PROGRESS */
        .progress-bar { height: 4px; background: rgba(255,255,255,0.1); border-radius: 99px; overflow: hidden; margin-top: 8px; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #c5a36b, #f1dca7); border-radius: 99px; transition: width 0.3s; width: 0%; }

        /* SECTION DIVIDER */
        .section-divider { display: flex; align-items: center; gap: 12px; margin: 20px 0 14px; }
        .section-divider span { font-size: 9px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.2em; color: #c5a36b; white-space: nowrap; }
        .section-divider::before, .section-divider::after { content: ''; flex: 1; height: 1px; background: linear-gradient(90deg, transparent, rgba(197,163,107,0.3), transparent); }

        /* TOAST */
        #toast { position: fixed; bottom: 24px; right: 24px; z-index: 99999; display: flex; flex-direction: column; gap: 8px; pointer-events: none; }
        .toast-item { padding: 12px 18px; border-radius: 10px; font-size: 12px; font-weight: 600; display: flex; align-items: center; gap: 10px; box-shadow: 0 8px 24px rgba(0,0,0,0.4); animation: slideUp 0.3s ease; pointer-events: all; }
        .toast-success { background: #052e16; border: 1px solid #10b981; color: #6ee7b7; }
        .toast-error   { background: #2d0a0a; border: 1px solid #ef4444; color: #fca5a5; }
        .toast-info    { background: #0c1a2e; border: 1px solid #3b82f6; color: #93c5fd; }
        @keyframes slideUp { from { opacity:0; transform:translateY(12px); } to { opacity:1; transform:translateY(0); } }

        /* MODAL */
        .modal-overlay { position: fixed; inset: 0; z-index: 9999; background: rgba(0,0,0,0.78); backdrop-filter: blur(8px); display: flex; align-items: center; justify-content: center; padding: 16px; }
        .modal-box { background: #0d1525; border: 1px solid rgba(197,163,107,0.3); border-radius: 18px; padding: 26px; width: 100%; max-width: 480px; max-height: 90vh; overflow-y: auto; }
        .modal-title { font-size: 11px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.15em; color: #c5a36b; margin-bottom: 18px; display: flex; justify-content: space-between; align-items: center; }
        .modal-close { color: #475569; background: none; border: none; font-size: 20px; cursor: pointer; line-height: 1; }
        .modal-close:hover { color: #f1f5f9; }

        /* INLINE EDIT */
        .edit-row { display: flex; align-items: center; gap: 6px; margin-bottom: 6px; }
        .edit-row .edit-input { flex: 1; }
    </style>
</head>
<body id="mainApp">

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HEADER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<header class="p-6 border-b border-[#c5a36b]/30 bg-[#0f172a] sticky top-0 z-50">
    <div class="max-w-6xl mx-auto flex justify-between items-center">
        <div class="flex items-center gap-3">
            <div class="w-12 h-12 gold-gradient rounded-lg flex items-center justify-center shadow-lg">
                <i class="fa-solid fa-scale-balanced text-black text-xl"></i>
            </div>
            <div>
                <h1 class="font-black text-xl tracking-tighter italic uppercase text-white">Painel CAD <span class="text-[#c5a36b]">V8</span></h1>
                <p class="text-[10px] uppercase tracking-widest text-[#c5a36b] font-bold">Presidente da CAD Maristela Gon√ßalves</p>
                <p class="text-[8px] uppercase tracking-[3px] text-slate-400">Santana de Parna√≠ba</p>
            </div>
        </div>
        <div class="flex items-center gap-3">
            <span id="adminBadge" class="hidden text-[9px] font-black uppercase tracking-widest px-3 py-1 rounded-full bg-[#c5a36b]/20 text-[#c5a36b] border border-[#c5a36b]/30">
                <i class="fa-solid fa-shield-halved mr-1"></i>Admin
            </span>
            <button onclick="toggleLogin()" class="opacity-30 hover:opacity-100 transition-opacity text-white">
                <i class="fa-solid fa-user-tie"></i>
            </button>
        </div>
    </div>
</header>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TABS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="max-w-6xl mx-auto px-4 pt-5 pb-1">
    <div class="tab-nav">
        <button class="tab-btn active" onclick="trocarAba('plantao',this)">
            <i class="fa-solid fa-calendar-check mr-1"></i>Plant√£o
        </button>
        <button class="tab-btn" onclick="trocarAba('assistencia',this)">
            <i class="fa-solid fa-handshake mr-1"></i>Conv√™nio
        </button>
        <button class="tab-btn" onclick="trocarAba('documentos',this)">
            <i class="fa-solid fa-folder-open mr-1"></i>Documentos
        </button>
        <button class="tab-btn" onclick="trocarAba('comissao',this)">
            <i class="fa-solid fa-users mr-1"></i>Comiss√£o
        </button>
        <button class="tab-btn" onclick="trocarAba('avisos',this)">
            <i class="fa-solid fa-bell mr-1"></i>Avisos
            <span id="badgeAvisos" class="hidden ml-1 bg-red-500 text-white text-[8px] font-black px-1.5 py-0.5 rounded-full align-middle"></span>
        </button>
    </div>
</div>

<main class="max-w-6xl mx-auto p-4">

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!--  ABA 1 ¬∑ PLANT√ÉO ‚Äî 100% ORIGINAL      -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="tab-plantao" class="tab-content active">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div class="lg:col-span-2">
            <div class="glass-card overflow-hidden">
                <div class="p-4 border-b border-white/5 flex justify-between items-center bg-white/5">
                    <h3 class="font-bold text-sm uppercase flex items-center gap-2">
                        <i class="fa-solid fa-calendar-check text-[#c5a36b]"></i> Escala de Plant√£o CAD
                    </h3>
                </div>
                <div id="containerEscala" class="min-h-[400px] flex items-center justify-center bg-black/20">
                    <p class="text-slate-500 italic">Conectando ao banco de dados...</p>
                </div>
            </div>
        </div>
        <div class="space-y-6">
            <div class="glass-card p-6">
                <div class="admin-section border-b border-white/10 pb-6 mb-6">
                    <span class="text-[10px] font-black text-[#c5a36b] uppercase block mb-4 tracking-widest text-center">Gest√£o da Presid√™ncia CAD</span>
                    <input type="file" id="fileIn" class="hidden" accept="image/*" onchange="uploadEscala(this)">
                    <button onclick="document.getElementById('fileIn').click()" class="btn-gold mb-4">
                        <i class="fa-solid fa-image mr-2"></i>ATUALIZAR ESCALA OFICIAL
                    </button>
                    <div class="space-y-2">
                        <input type="text" id="dataTroca" placeholder="Data (Ex: 17/02)" class="input-oab">
                        <input type="text" id="advSai" placeholder="Advogado(a) que SAI" class="input-oab">
                        <input type="text" id="advEntra" placeholder="Advogado(a) que ENTRA" class="input-oab">
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="registrar('T')" class="btn-gold text-[11px]">REGISTRAR TROCA</button>
                            <button onclick="registrar('F')" class="bg-red-700 hover:bg-red-800 text-white font-bold p-3 rounded-lg text-[11px] uppercase w-full cursor-pointer border-none">FALTA</button>
                        </div>
                    </div>
                    <button onclick="exportarExcel()" class="w-full mt-4 bg-emerald-700 text-white p-2 rounded-lg text-[10px] font-bold uppercase hover:bg-emerald-600 transition flex items-center justify-center gap-2 cursor-pointer border-none">
                        <i class="fa-solid fa-file-excel"></i> Gerar Relat√≥rio CAD
                    </button>
                </div>
                <span class="text-[10px] font-black text-[#c5a36b] uppercase block mb-4 tracking-widest border-b border-[#c5a36b]/20 pb-2">Registros da Comiss√£o</span>
                <div id="listaLogs" class="max-h-[500px] overflow-y-auto space-y-3 pr-2"></div>
            </div>
        </div>
    </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!--  ABA 2 ¬∑ CONV√äNIO                     -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="tab-assistencia" class="tab-content">

    <!-- Stats edit√°veis -->
    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
        <div class="stat-card" onclick="editarStat('casos')" title="Clique para editar">
            <div class="stat-icon" style="background:rgba(197,163,107,0.1)">
                <i class="fa-solid fa-gavel" style="color:#c5a36b"></i>
            </div>
            <div>
                <div class="stat-value" id="statCasos">‚Äî</div>
                <div class="stat-label">Casos Ativos</div>
                <div class="admin-section text-[8px] text-slate-600 mt-1"><i class="fa-solid fa-pen fa-xs"></i> editar</div>
            </div>
        </div>
        <div class="stat-card" onclick="editarStat('encerrados')" title="Clique para editar">
            <div class="stat-icon" style="background:rgba(16,185,129,0.1)">
                <i class="fa-solid fa-circle-check" style="color:#10b981"></i>
            </div>
            <div>
                <div class="stat-value" id="statEncerrados">‚Äî</div>
                <div class="stat-label">Encerrados</div>
                <div class="admin-section text-[8px] text-slate-600 mt-1"><i class="fa-solid fa-pen fa-xs"></i> editar</div>
            </div>
        </div>
        <div class="stat-card" id="statMembroCard">
            <div class="stat-icon" style="background:rgba(59,130,246,0.1)">
                <i class="fa-solid fa-users" style="color:#3b82f6"></i>
            </div>
            <div>
                <div class="stat-value" id="statMembros">‚Äî</div>
                <div class="stat-label">Membros CAD</div>
            </div>
        </div>
        <div class="stat-card" onclick="editarStat('vigencia')" title="Clique para editar">
            <div class="stat-icon" style="background:rgba(245,158,11,0.1)">
                <i class="fa-solid fa-calendar-days" style="color:#f59e0b"></i>
            </div>
            <div>
                <div class="stat-value" id="statVigencia">‚Äî</div>
                <div class="stat-label">Vig√™ncia (ano)</div>
                <div class="admin-section text-[8px] text-slate-600 mt-1"><i class="fa-solid fa-pen fa-xs"></i> editar</div>
            </div>
        </div>
    </div>

    <div class="info-card">
        <div class="info-card-title">
            <i class="fa-solid fa-file-contract"></i> Informa√ß√µes do Conv√™nio
            <button onclick="abrirModalConvenio()" class="admin-section ml-auto btn-sm btn-sm-gold">
                <i class="fa-solid fa-pen mr-1"></i> Editar Conv√™nio
            </button>
        </div>
        <div id="listaConvenio" class="grid grid-cols-1 md:grid-cols-2 gap-x-8"></div>
    </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!--  ABA 3 ¬∑ DOCUMENTOS                   -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="tab-documentos" class="tab-content">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

        <!-- Upload (admin) -->
        <div class="info-card admin-section">
            <div class="info-card-title"><i class="fa-solid fa-cloud-arrow-up"></i> Enviar Documento</div>

            <div class="upload-zone" id="uploadZone" onclick="document.getElementById('fileDocInput').click()"
                ondragover="event.preventDefault();this.classList.add('dragover')"
                ondragleave="this.classList.remove('dragover')"
                ondrop="handleDrop(event)">
                <i class="fa-solid fa-cloud-arrow-up"></i>
                <strong>Clique ou arraste o arquivo aqui</strong>
                <p class="mt-1">PDF, Word, Excel, Imagem</p>
                <p class="mt-1 text-[10px]">M√°x. 20 MB</p>
            </div>
            <input type="file" id="fileDocInput" class="hidden" accept=".pdf,.doc,.docx,.xls,.xlsx,.png,.jpg,.jpeg" onchange="handleFileSelect(this)">

            <div id="uploadProgress" class="hidden mt-3">
                <div class="flex justify-between text-[10px] text-slate-400 mb-1">
                    <span id="uploadFileName">Enviando...</span>
                    <span id="uploadPct">0%</span>
                </div>
                <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
            </div>

            <div class="section-divider"><span>Detalhes</span></div>
            <div class="space-y-2">
                <input type="text" id="docNome" placeholder="Nome do documento" class="edit-input">
                <input type="text" id="docDesc" placeholder="Descri√ß√£o curta (opcional)" class="edit-input">
                <select id="docCategoria" class="edit-select">
                    <option value="convenio">Conv√™nio</option>
                    <option value="formulario">Formul√°rio</option>
                    <option value="resolucao">Resolu√ß√£o / Portaria</option>
                    <option value="relatorio">Relat√≥rio</option>
                    <option value="outro">Outro</option>
                </select>
                <button onclick="confirmarUpload()" class="btn-gold mt-1" id="btnEnviar" disabled style="opacity:0.4">
                    <i class="fa-solid fa-paper-plane mr-2"></i>ENVIAR DOCUMENTO
                </button>
            </div>
        </div>

        <!-- Lista de documentos -->
        <div class="lg:col-span-2 info-card">
            <div class="info-card-title">
                <i class="fa-solid fa-folder-open"></i> Reposit√≥rio de Documentos
                <div class="ml-auto flex gap-2">
                    <select id="filtroCategoria" class="edit-select text-[10px] py-1 px-2" onchange="renderDocs()" style="width:auto">
                        <option value="">Todos</option>
                        <option value="convenio">Conv√™nio</option>
                        <option value="formulario">Formul√°rio</option>
                        <option value="resolucao">Resolu√ß√£o</option>
                        <option value="relatorio">Relat√≥rio</option>
                        <option value="outro">Outro</option>
                    </select>
                </div>
            </div>
            <div id="listaDocs">
                <p class="text-[11px] text-slate-600 italic">Carregando documentos...</p>
            </div>
        </div>
    </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!--  ABA 4 ¬∑ COMISS√ÉO                     -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="tab-comissao" class="tab-content">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

        <!-- Membros -->
        <div class="info-card">
            <div class="info-card-title">
                <i class="fa-solid fa-users-gear"></i> Membros da Comiss√£o
                <button onclick="abrirModalMembro()" class="admin-section ml-auto btn-sm btn-sm-gold">
                    <i class="fa-solid fa-plus mr-1"></i> Adicionar
                </button>
            </div>
            <div id="listaContatos">
                <p class="text-[11px] text-slate-600 italic">Nenhum membro cadastrado.</p>
            </div>
        </div>

        <!-- Contatos Inst + Sobre -->
        <div class="info-card">
            <div class="info-card-title">
                <i class="fa-solid fa-landmark"></i> Contatos Institucionais
                <button onclick="abrirModalContInst()" class="admin-section ml-auto btn-sm btn-sm-gold">
                    <i class="fa-solid fa-plus mr-1"></i> Adicionar
                </button>
            </div>
            <div id="listaContInst">
                <p class="text-[11px] text-slate-600 italic">Nenhum contato cadastrado.</p>
            </div>

            <div class="section-divider"><span>Sobre a CAD</span></div>
            <div class="text-[12px] text-slate-400 leading-relaxed" id="textoSobreCAD">
                A Comiss√£o de Assist√™ncia e Advocacia Dativa de Santana de Parna√≠ba atua em defesa dos cidad√£os que n√£o possuem condi√ß√µes de arcar com honor√°rios advocat√≠cios, garantindo o acesso √† Justi√ßa previsto na Constitui√ß√£o Federal.
            </div>
            <button onclick="editarSobre()" class="admin-section mt-3 text-[9px] text-[#c5a36b] hover:underline border-none bg-transparent cursor-pointer">
                <i class="fa-solid fa-pen mr-1"></i> Editar texto
            </button>
        </div>
    </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!--  ABA 5 ¬∑ AVISOS                       -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="tab-avisos" class="tab-content">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

        <div class="lg:col-span-2 info-card">
            <div class="info-card-title"><i class="fa-solid fa-bullhorn"></i> Comunicados & Avisos</div>
            <div id="listaAvisos">
                <p class="text-[11px] text-slate-600 italic">Nenhum aviso publicado.</p>
            </div>
        </div>

        <!-- Form novo aviso (admin) -->
        <div class="info-card admin-section">
            <div class="info-card-title"><i class="fa-solid fa-plus-circle"></i> Novo Aviso</div>
            <div class="space-y-2">
                <select id="tipoAviso" class="edit-select">
                    <option value="info">‚ÑπÔ∏è Informativo</option>
                    <option value="alerta">‚ö†Ô∏è Alerta</option>
                    <option value="urgente">üî¥ Urgente</option>
                    <option value="ok">‚úÖ Resolvido</option>
                </select>
                <input type="text" id="tituloAviso" placeholder="T√≠tulo do aviso" class="edit-input">
                <textarea id="textoAviso" placeholder="Mensagem completa..." class="edit-input" rows="5" style="resize:vertical"></textarea>
                <button onclick="publicarAviso()" class="btn-gold">
                    <i class="fa-solid fa-paper-plane mr-2"></i>PUBLICAR AVISO
                </button>
            </div>
        </div>

        <div class="info-card hide-admin">
            <div class="info-card-title"><i class="fa-solid fa-circle-info"></i> Informa√ß√£o</div>
            <p class="text-[11px] text-slate-500">Comunicados s√£o publicados pela Presid√™ncia da CAD. Fa√ßa login para gerenciar.</p>
        </div>
    </div>
</div>

</main>

<footer>
    <p>A responsabilidade √© de quem est√° usando e o programa apenas gera o prompt.</p>
    <p class="mt-2 text-[#c5a36b] font-bold uppercase">C√°ssia Prompt V8 - Santana de Parna√≠ba ¬© 2026</p>
</footer>

<!-- ‚ïê‚ïê‚ïê TOAST ‚ïê‚ïê‚ïê -->
<div id="toast"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  FIREBASE ‚Äî CONFIG ORIGINAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const firebaseConfig = {
    apiKey: "AIzaSyCBxYwyTieXWmzC_yGq0Abyr5xXZoj-4ts",
    authDomain: "cassia-assistencia-v8.firebaseapp.com",
    projectId: "cassia-assistencia-v8",
    storageBucket: "cassia-assistencia-v8.firebasestorage.app",
    messagingSenderId: "1082407112672",
    appId: "1:1082407112672:web:ea69563be63a9bd8036585",
    databaseURL: "https://cassia-assistencia-v8-default-rtdb.firebaseio.com/"
};
firebase.initializeApp(firebaseConfig);
const db      = firebase.database();
const storage = firebase.storage();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  LOGIN
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let isAdmin = false;
function toggleLogin() {
    if(isAdmin) {
        isAdmin = false;
        document.getElementById('mainApp').classList.remove('is-admin');
        document.getElementById('adminBadge').classList.add('hidden');
        toast('Sess√£o encerrada.', 'info');
    } else {
        const senha = prompt("üîê Senha Master CAD:");
        if(senha === "CAD2026") {
            isAdmin = true;
            document.getElementById('mainApp').classList.add('is-admin');
            document.getElementById('adminBadge').classList.remove('hidden');
            toast('Bem-vinda, Presid√™ncia CAD!', 'success');
        } else if(senha !== null) {
            toast('Senha incorreta.', 'error');
        }
    }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TOAST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toast(msg, tipo = 'info') {
    const t = document.getElementById('toast');
    const icons = { success: 'fa-circle-check', error: 'fa-circle-xmark', info: 'fa-circle-info' };
    const el = document.createElement('div');
    el.className = `toast-item toast-${tipo}`;
    el.innerHTML = `<i class="fa-solid ${icons[tipo]}"></i> ${msg}`;
    t.appendChild(el);
    setTimeout(() => el.remove(), 3500);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TABS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function trocarAba(aba, btn) {
    document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.getElementById('tab-' + aba).classList.add('active');
    btn.classList.add('active');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  ESCALA ‚Äî ORIGINAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function uploadEscala(input) {
    const file = input.files[0];
    const reader = new FileReader();
    reader.onload = (e) => {
        db.ref('escala_v8').set(e.target.result);
        toast('Escala atualizada!', 'success');
    };
    reader.readAsDataURL(file);
}
db.ref('escala_v8').on('value', snap => {
    const imgData = snap.val();
    const container = document.getElementById('containerEscala');
    if(imgData) container.innerHTML = `<img src="${imgData}" class="w-full">`;
    else container.innerHTML = `<p class="text-slate-500 italic">Nenhuma escala publicada.</p>`;
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  LOGS ‚Äî ORIGINAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function registrar(tipo) {
    const d = document.getElementById('dataTroca').value;
    const s = document.getElementById('advSai').value;
    const e = document.getElementById('advEntra').value;
    if(!d || !s) return toast('Preencha os dados!', 'error');
    db.ref('logs_v8').push({ tipo, data: d, saiu: s, entrou: tipo === 'F' ? 'FALTA' : (e || '---'), timestamp: Date.now() });
    document.getElementById('advSai').value = '';
    document.getElementById('advEntra').value = '';
    toast(tipo === 'F' ? 'Falta registrada.' : 'Troca registrada.', 'success');
}
db.ref('logs_v8').on('value', snap => {
    const lista = document.getElementById('listaLogs');
    lista.innerHTML = '';
    const data = snap.val();
    if(data) {
        Object.keys(data).reverse().forEach(id => {
            const item = data[id];
            const isFalta = item.tipo === 'F';
            lista.innerHTML += `<div class="log-item ${isFalta ? 'falta-item' : ''}">
                <div class="flex justify-between items-center mb-1">
                    <span class="text-[10px] font-bold text-[#c5a36b]">[ ${item.data} ]</span>
                    <button onclick="apagar('${id}')" class="admin-section text-red-900 text-[10px] bg-transparent border-none cursor-pointer">Excluir</button>
                </div>
                <div class="text-[11px] uppercase">
                    ${isFalta ? `<b class="text-red-500">FALTA:</b> ${item.saiu}` : `<b>SAIU:</b> ${item.saiu} ‚Üí <b>ENTROU:</b> ${item.entrou}`}
                </div></div>`;
        });
    }
});
function apagar(id) { if(confirm("Excluir registro?")) db.ref('logs_v8').child(id).remove(); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  EXCEL ‚Äî ORIGINAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function exportarExcel() {
    db.ref('logs_v8').once('value', snap => {
        const logs = snap.val();
        if(!logs) return toast('Sem dados para exportar.', 'error');
        const rows = Object.values(logs).map(i => ({
            "DATA": i.data, "STATUS": i.tipo === 'F' ? 'FALTA' : 'TROCA', "ADV_SAIU": i.saiu, "ADV_ENTROU": i.entrou
        }));
        const ws = XLSX.utils.json_to_sheet(rows);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "CAD");
        XLSX.writeFile(wb, "Relatorio_CAD.xlsx");
    });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CONV√äNIO
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const convenioDefault = [
    { label: "√ìrg√£o Conveniante", value: "OAB Subse√ß√£o Santana de Parna√≠ba" },
    { label: "Convenente",        value: "Tribunal de Justi√ßa SP" },
    { label: "Vig√™ncia",          value: "‚Äî" },
    { label: "Valor por Ato",     value: "‚Äî" },
    { label: "Prazo de Pagamento",value: "‚Äî" },
    { label: "N¬∫ do Conv√™nio",    value: "‚Äî" },
    { label: "Data de Assinatura",value: "‚Äî" },
    { label: "Respons√°vel",       value: "Dra. Maristela Gon√ßalves" }
];
db.ref('convenio_v8').on('value', snap => {
    const data = snap.val() || convenioDefault;
    const lista = document.getElementById('listaConvenio');
    lista.innerHTML = data.map(r => `
        <div class="convenio-row">
            <span class="convenio-label">${r.label}</span>
            <span class="convenio-value">${r.value}</span>
        </div>`).join('');
    const vig = data.find(r => r.label === 'Vig√™ncia');
    if(vig && vig.value !== '‚Äî') document.getElementById('statVigencia').textContent = vig.value;
});

function abrirModalConvenio() {
    db.ref('convenio_v8').once('value', snap => {
        const data = snap.val() || convenioDefault;
        abrirModal('Editar Informa√ß√µes do Conv√™nio', `
            <div id="convenioRows">
                ${data.map((r,i) => `
                <div class="edit-row" id="cr${i}">
                    <input class="edit-input" style="flex:1.2" value="${r.label}" id="cl${i}" placeholder="Campo">
                    <input class="edit-input" style="flex:2" value="${r.value}" id="cv${i}" placeholder="Valor">
                    <button onclick="document.getElementById('cr${i}').remove()" class="btn-sm btn-sm-red" style="flex-shrink:0">‚úï</button>
                </div>`).join('')}
            </div>
            <button onclick="adicionarLinhaConvenio()" class="btn-sm btn-sm-blue w-full mt-3">
                <i class="fa-solid fa-plus mr-1"></i> Adicionar linha
            </button>
            <button onclick="salvarConvenio()" class="btn-gold mt-3">
                <i class="fa-solid fa-floppy-disk mr-2"></i>SALVAR CONV√äNIO
            </button>
        `);
    });
}
let _convenioIdx = 20;
function adicionarLinhaConvenio() {
    const i = _convenioIdx++;
    const div = document.createElement('div');
    div.className = 'edit-row';
    div.id = `cr${i}`;
    div.innerHTML = `
        <input class="edit-input" style="flex:1.2" id="cl${i}" placeholder="Campo">
        <input class="edit-input" style="flex:2" id="cv${i}" placeholder="Valor">
        <button onclick="document.getElementById('cr${i}').remove()" class="btn-sm btn-sm-red" style="flex-shrink:0">‚úï</button>`;
    document.getElementById('convenioRows').appendChild(div);
}
function salvarConvenio() {
    const arr = [];
    document.querySelectorAll('#convenioRows .edit-row').forEach(row => {
        const id = row.id.replace('cr','');
        const l = document.getElementById('cl'+id)?.value?.trim();
        const v = document.getElementById('cv'+id)?.value?.trim();
        if(l) arr.push({ label: l, value: v || '‚Äî' });
    });
    db.ref('convenio_v8').set(arr);
    fecharModal();
    toast('Conv√™nio atualizado!', 'success');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  STATS EDIT√ÅVEIS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
db.ref('stats_v8').on('value', snap => {
    const d = snap.val() || {};
    document.getElementById('statCasos').textContent      = d.casos      || '‚Äî';
    document.getElementById('statEncerrados').textContent = d.encerrados || '‚Äî';
    if(d.vigencia) document.getElementById('statVigencia').textContent = d.vigencia;
});
function editarStat(campo) {
    if(!isAdmin) return;
    const labels = { casos: 'Casos Ativos', encerrados: 'Encerrados', vigencia: 'Vig√™ncia (ano/per√≠odo)' };
    abrirModal(`Editar: ${labels[campo]}`, `
        <input type="text" id="statInput" class="edit-input mb-3" placeholder="Novo valor" value="${document.getElementById('stat'+campo.charAt(0).toUpperCase()+campo.slice(1)).textContent.replace('‚Äî','')}">
        <button onclick="salvarStat('${campo}')" class="btn-gold">
            <i class="fa-solid fa-floppy-disk mr-2"></i>SALVAR
        </button>`);
    setTimeout(() => document.getElementById('statInput')?.focus(), 100);
}
function salvarStat(campo) {
    const v = document.getElementById('statInput').value.trim();
    db.ref('stats_v8/'+campo).set(v || '‚Äî');
    fecharModal();
    toast('Estat√≠stica atualizada!', 'success');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DOCUMENTOS ‚Äî Firebase Storage
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let pendingFile = null;

function handleFileSelect(input) {
    if(input.files[0]) setPendingFile(input.files[0]);
}
function handleDrop(e) {
    e.preventDefault();
    document.getElementById('uploadZone').classList.remove('dragover');
    if(e.dataTransfer.files[0]) setPendingFile(e.dataTransfer.files[0]);
}
function setPendingFile(file) {
    pendingFile = file;
    const maxMB = 20;
    if(file.size > maxMB * 1024 * 1024) {
        toast(`Arquivo muito grande! M√°x ${maxMB}MB.`, 'error');
        pendingFile = null;
        return;
    }
    document.getElementById('docNome').value = file.name.replace(/\.[^.]+$/,'');
    document.getElementById('btnEnviar').disabled = false;
    document.getElementById('btnEnviar').style.opacity = '1';
    document.getElementById('uploadZone').innerHTML = `
        <i class="fa-solid fa-file-circle-check" style="color:#10b981"></i>
        <strong style="color:#10b981">${file.name}</strong>
        <p class="mt-1">${(file.size/1024/1024).toFixed(2)} MB ¬∑ Pronto para enviar</p>`;
    toast(`Arquivo selecionado: ${file.name}`, 'info');
}

function confirmarUpload() {
    if(!pendingFile) return toast('Selecione um arquivo.', 'error');
    const nome = document.getElementById('docNome').value.trim() || pendingFile.name;
    const desc = document.getElementById('docDesc').value.trim();
    const cat  = document.getElementById('docCategoria').value;
    const ext  = pendingFile.name.split('.').pop().toLowerCase();
    const path = `documentos_cad/${Date.now()}_${pendingFile.name}`;

    document.getElementById('uploadProgress').classList.remove('hidden');
    document.getElementById('btnEnviar').disabled = true;
    document.getElementById('btnEnviar').style.opacity = '0.5';

    const ref   = storage.ref(path);
    const task  = ref.put(pendingFile);

    task.on('state_changed',
        snapshot => {
            const pct = Math.round(snapshot.bytesTransferred / snapshot.totalBytes * 100);
            document.getElementById('progressFill').style.width = pct + '%';
            document.getElementById('uploadPct').textContent = pct + '%';
            document.getElementById('uploadFileName').textContent = pendingFile.name;
        },
        err => {
            toast('Erro no upload: ' + err.message, 'error');
            document.getElementById('btnEnviar').disabled = false;
            document.getElementById('btnEnviar').style.opacity = '1';
        },
        () => {
            task.snapshot.ref.getDownloadURL().then(url => {
                db.ref('docs_v8').push({
                    nome, desc, cat, ext, url,
                    tamanho: (pendingFile.size/1024/1024).toFixed(2) + ' MB',
                    timestamp: Date.now()
                });
                toast(`"${nome}" enviado com sucesso!`, 'success');
                pendingFile = null;
                document.getElementById('docNome').value = '';
                document.getElementById('docDesc').value = '';
                document.getElementById('uploadProgress').classList.add('hidden');
                document.getElementById('progressFill').style.width = '0%';
                document.getElementById('btnEnviar').disabled = true;
                document.getElementById('btnEnviar').style.opacity = '0.4';
                document.getElementById('uploadZone').innerHTML = `
                    <i class="fa-solid fa-cloud-arrow-up"></i>
                    <strong>Clique ou arraste o arquivo aqui</strong>
                    <p class="mt-1">PDF, Word, Excel, Imagem</p>
                    <p class="mt-1 text-[10px]">M√°x. 20 MB</p>`;
            });
        }
    );
}

const docIcones = {
    pdf:  { bg: 'rgba(239,68,68,0.15)',   color: '#ef4444', icon: 'fa-file-pdf' },
    doc:  { bg: 'rgba(59,130,246,0.15)',  color: '#3b82f6', icon: 'fa-file-word' },
    docx: { bg: 'rgba(59,130,246,0.15)',  color: '#3b82f6', icon: 'fa-file-word' },
    xls:  { bg: 'rgba(16,185,129,0.15)', color: '#10b981', icon: 'fa-file-excel' },
    xlsx: { bg: 'rgba(16,185,129,0.15)', color: '#10b981', icon: 'fa-file-excel' },
    png:  { bg: 'rgba(168,85,247,0.15)', color: '#a855f7', icon: 'fa-file-image' },
    jpg:  { bg: 'rgba(168,85,247,0.15)', color: '#a855f7', icon: 'fa-file-image' },
    jpeg: { bg: 'rgba(168,85,247,0.15)', color: '#a855f7', icon: 'fa-file-image' },
};
const catLabels = { convenio:'Conv√™nio', formulario:'Formul√°rio', resolucao:'Resolu√ß√£o', relatorio:'Relat√≥rio', outro:'Outro' };
let todosOsDocs = {};

db.ref('docs_v8').on('value', snap => {
    todosOsDocs = snap.val() || {};
    renderDocs();
});

function renderDocs() {
    const lista    = document.getElementById('listaDocs');
    const filtro   = document.getElementById('filtroCategoria')?.value || '';
    const entries  = Object.entries(todosOsDocs).reverse();
    const filtered = filtro ? entries.filter(([,d]) => d.cat === filtro) : entries;

    if(!filtered.length) {
        lista.innerHTML = '<p class="text-[11px] text-slate-600 italic">Nenhum documento encontrado.</p>';
        return;
    }
    lista.innerHTML = filtered.map(([id, d]) => {
        const ico = docIcones[d.ext] || { bg:'rgba(100,116,139,0.15)', color:'#94a3b8', icon:'fa-file' };
        return `<a href="${d.url}" target="_blank" rel="noopener" class="doc-item">
            <div class="doc-icon" style="background:${ico.bg}">
                <i class="fa-solid ${ico.icon}" style="color:${ico.color}"></i>
            </div>
            <div class="flex-1 min-w-0">
                <div class="doc-name truncate">${d.nome}</div>
                ${d.desc ? `<div class="doc-desc truncate">${d.desc}</div>` : ''}
                <div class="doc-size flex gap-3 mt-1">
                    <span class="uppercase tracking-wide" style="color:${ico.color}">${d.ext?.toUpperCase()}</span>
                    ${d.tamanho ? `<span>${d.tamanho}</span>` : ''}
                    ${d.cat ? `<span class="text-slate-500">${catLabels[d.cat]||d.cat}</span>` : ''}
                </div>
            </div>
            <div class="flex items-center gap-2 ml-2 flex-shrink-0">
                <i class="fa-solid fa-arrow-down-to-line text-[#c5a36b] text-[11px]"></i>
                <button onclick="event.preventDefault();apagarDoc('${id}')" class="admin-section btn-sm btn-sm-red text-[9px]">‚úï</button>
            </div>
        </a>`;
    }).join('');
}

function apagarDoc(id) {
    if(!confirm('Remover este documento?')) return;
    db.ref('docs_v8/'+id).once('value', snap => {
        const d = snap.val();
        if(d?.url) {
            storage.refFromURL(d.url).delete().catch(()=>{});
        }
        db.ref('docs_v8/'+id).remove();
        toast('Documento removido.', 'info');
    });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  MEMBROS DA COMISS√ÉO
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
db.ref('contatos_v8').on('value', snap => {
    const lista = document.getElementById('listaContatos');
    const data  = snap.val();
    if(!data) { lista.innerHTML = '<p class="text-[11px] text-slate-600 italic">Nenhum membro cadastrado.</p>'; return; }
    lista.innerHTML = Object.entries(data).map(([id, c]) => `
        <div class="contact-item">
            <div class="contact-avatar"><i class="fa-solid fa-user-tie"></i></div>
            <div class="flex-1">
                <div class="contact-name">${c.nome}</div>
                <div class="contact-role">${c.cargo||''}</div>
                ${c.tel ? `<div class="contact-phone"><i class="fa-solid fa-phone fa-xs mr-1"></i>${c.tel}</div>` : ''}
                ${c.email ? `<div class="contact-phone" style="color:#94a3b8"><i class="fa-solid fa-envelope fa-xs mr-1"></i>${c.email}</div>` : ''}
            </div>
            <button onclick="apagarContato('${id}')" class="admin-section btn-sm btn-sm-red text-[9px]">‚úï</button>
        </div>`).join('');
    document.getElementById('statMembros').textContent = Object.keys(data).length;
});

function abrirModalMembro() {
    abrirModal('Novo Membro da Comiss√£o', `
        <div class="space-y-2">
            <input class="edit-input" id="cNome"  placeholder="Nome completo *">
            <input class="edit-input" id="cCargo" placeholder="Cargo / Fun√ß√£o (Ex: Presidente, Membro)">
            <input class="edit-input" id="cTel"   placeholder="Telefone">
            <input class="edit-input" id="cEmail" placeholder="E-mail">
            <button onclick="salvarContato()" class="btn-gold mt-2">
                <i class="fa-solid fa-floppy-disk mr-2"></i>SALVAR MEMBRO
            </button>
        </div>`);
}
function salvarContato() {
    const n = document.getElementById('cNome').value.trim();
    if(!n) return toast('Informe o nome.', 'error');
    db.ref('contatos_v8').push({
        nome:  n,
        cargo: document.getElementById('cCargo').value.trim(),
        tel:   document.getElementById('cTel').value.trim(),
        email: document.getElementById('cEmail').value.trim()
    });
    fecharModal();
    toast('Membro adicionado!', 'success');
}
function apagarContato(id) { if(confirm('Remover membro?')) { db.ref('contatos_v8/'+id).remove(); toast('Membro removido.','info'); } }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CONTATOS INSTITUCIONAIS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
db.ref('contInst_v8').on('value', snap => {
    const lista = document.getElementById('listaContInst');
    const data  = snap.val();
    if(!data) { lista.innerHTML = '<p class="text-[11px] text-slate-600 italic">Nenhum contato cadastrado.</p>'; return; }
    lista.innerHTML = Object.entries(data).map(([id, c]) => `
        <div class="contact-item">
            <div class="contact-avatar" style="background:linear-gradient(135deg,#1a2a1a,#2a402a);border-color:rgba(16,185,129,0.3)">
                <i class="fa-solid fa-landmark" style="color:#10b981"></i>
            </div>
            <div class="flex-1">
                <div class="contact-name">${c.nome}</div>
                <div class="contact-role">${c.org||''}</div>
                ${c.tel ? `<div class="contact-phone"><i class="fa-solid fa-phone fa-xs mr-1"></i>${c.tel}</div>` : ''}
            </div>
            <button onclick="apagarContInst('${id}')" class="admin-section btn-sm btn-sm-red text-[9px]">‚úï</button>
        </div>`).join('');
});
function abrirModalContInst() {
    abrirModal('Contato Institucional', `
        <div class="space-y-2">
            <input class="edit-input" id="iNome" placeholder="Nome do contato *">
            <input class="edit-input" id="iOrg"  placeholder="Organiza√ß√£o / Tribunal">
            <input class="edit-input" id="iTel"  placeholder="Telefone">
            <button onclick="salvarContInst()" class="btn-gold mt-2">
                <i class="fa-solid fa-floppy-disk mr-2"></i>SALVAR CONTATO
            </button>
        </div>`);
}
function salvarContInst() {
    const n = document.getElementById('iNome').value.trim();
    if(!n) return toast('Informe o nome.', 'error');
    db.ref('contInst_v8').push({ nome: n, org: document.getElementById('iOrg').value.trim(), tel: document.getElementById('iTel').value.trim() });
    fecharModal();
    toast('Contato adicionado!', 'success');
}
function apagarContInst(id) { if(confirm('Remover?')) { db.ref('contInst_v8/'+id).remove(); toast('Removido.','info'); } }

// Sobre CAD
db.ref('sobre_v8').on('value', snap => { if(snap.val()) document.getElementById('textoSobreCAD').textContent = snap.val(); });
function editarSobre() {
    const atual = document.getElementById('textoSobreCAD').textContent;
    abrirModal('Sobre a CAD', `
        <textarea class="edit-input mb-3" rows="7" id="sobreTxt">${atual}</textarea>
        <button onclick="db.ref('sobre_v8').set(document.getElementById('sobreTxt').value);fecharModal();toast('Texto atualizado!','success')" class="btn-gold">
            <i class="fa-solid fa-floppy-disk mr-2"></i>SALVAR
        </button>`);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  AVISOS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const avisoClasses = { info:'aviso-info', alerta:'aviso-alerta', urgente:'aviso-urgente', ok:'aviso-ok' };
const avisoBadges  = { info:'badge-info', alerta:'badge-alerta', urgente:'badge-urgente', ok:'badge-ok' };
const avisoLabels  = { info:'Informativo', alerta:'Alerta', urgente:'URGENTE', ok:'Resolvido' };

db.ref('avisos_v8').on('value', snap => {
    const lista   = document.getElementById('listaAvisos');
    const data    = snap.val();
    if(!data) { lista.innerHTML = '<p class="text-[11px] text-slate-600 italic">Nenhum aviso publicado.</p>'; return; }
    const entries = Object.entries(data).reverse();
    lista.innerHTML = entries.map(([id, a]) => `
        <div class="aviso-item ${avisoClasses[a.tipo]||'aviso-info'}">
            <span class="aviso-badge ${avisoBadges[a.tipo]||'badge-info'}">${avisoLabels[a.tipo]||'Info'}</span>
            <div class="font-bold text-[13px] text-white mb-1">${a.titulo||''}</div>
            <div class="aviso-text">${a.texto}</div>
            <div class="flex justify-between items-center mt-2">
                <div class="aviso-data">${a.data||''}</div>
                <button onclick="apagarAviso('${id}')" class="admin-section btn-sm btn-sm-red text-[9px]">‚úï Excluir</button>
            </div>
        </div>`).join('');

    const urgentes = entries.filter(([,a]) => a.tipo === 'urgente').length;
    const badge = document.getElementById('badgeAvisos');
    if(urgentes > 0) { badge.textContent = urgentes; badge.classList.remove('hidden'); }
    else badge.classList.add('hidden');
});

function publicarAviso() {
    const t     = document.getElementById('textoAviso').value.trim();
    const titulo= document.getElementById('tituloAviso').value.trim();
    if(!t) return toast('Escreva a mensagem.', 'error');
    const tipo  = document.getElementById('tipoAviso').value;
    const agora = new Date();
    const data  = agora.toLocaleDateString('pt-BR') + ' ' + agora.toLocaleTimeString('pt-BR', {hour:'2-digit',minute:'2-digit'});
    db.ref('avisos_v8').push({ tipo, titulo, texto: t, data });
    document.getElementById('textoAviso').value  = '';
    document.getElementById('tituloAviso').value = '';
    toast('Aviso publicado!', 'success');
}
function apagarAviso(id) { if(confirm('Excluir aviso?')) { db.ref('avisos_v8/'+id).remove(); toast('Aviso exclu√≠do.','info'); } }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  MODAL HELPER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function abrirModal(titulo, htmlBody) {
    fecharModal();
    const overlay = document.createElement('div');
    overlay.className = 'modal-overlay';
    overlay.id = 'modalCAD';
    overlay.innerHTML = `
        <div class="modal-box">
            <div class="modal-title">
                ${titulo}
                <button class="modal-close" onclick="fecharModal()">√ó</button>
            </div>
            ${htmlBody}
        </div>`;
    overlay.addEventListener('click', e => { if(e.target === overlay) fecharModal(); });
    document.body.appendChild(overlay);
}
function fecharModal() { document.getElementById('modalCAD')?.remove(); }
</script>
</body>
</html>
